From 5597016c3908fe472f00d62195a949c9fe56ea29 Mon Sep 17 00:00:00 2001
From: Salvo Giangreco <giangrecosalvo9@gmail.com>
Date: Fri, 13 Sep 2024 14:44:20 +0200
Subject: [PATCH] Add optical FOD support

---
diff --git a/smali/com/android/keyguard/KeyguardSecUpdateMonitor.smali b/smali/com/android/keyguard/KeyguardSecUpdateMonitor.smali
index d2321057..5e79b76d 100644
--- a/smali/com/android/keyguard/KeyguardSecUpdateMonitor.smali
+++ b/smali/com/android/keyguard/KeyguardSecUpdateMonitor.smali
@@ -858,6 +858,12 @@
     return-void
 .end method
 
+.method public removeMaskViewForOpticalFpSensor()V
+    .locals 0
+
+    return-void
+.end method
+
 .method public requestSessionClose()V
     .locals 0
 
diff --git a/smali/com/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda13.smali b/smali/com/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda13.smali
new file mode 100644
index 00000000..f3e2d50d
--- /dev/null
+++ b/smali/com/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda13.smali
@@ -0,0 +1,80 @@
+.class public final synthetic Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda13;
+.super Ljava/lang/Object;
+.source "qb/92319763 2ed430039e3a76671f5eeeb993a34e9b0a25280596262a8b7b4546be94639850"
+
+# interfaces
+.implements Lcom/android/systemui/util/SettingsHelper$OnChangedCallback;
+
+
+# instance fields
+.field public final synthetic $r8$classId:I
+
+.field public final synthetic f$0:Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;
+
+
+# direct methods
+.method public synthetic constructor <init>(Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;I)V
+    .locals 0
+
+    iput p2, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda13;->$r8$classId:I
+
+    iput-object p1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda13;->f$0:Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;
+
+    invoke-direct {p0}, Ljava/lang/Object;-><init>()V
+
+    return-void
+.end method
+
+
+# virtual methods
+.method public final onChanged(Landroid/net/Uri;)V
+    .locals 0
+
+    iget p1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda13;->$r8$classId:I
+
+    packed-switch p1, :pswitch_data_0
+
+    iget-object p0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda13;->f$0:Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;
+
+    invoke-static {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->$r8$lambda$kJTDZ_s3Y5_-kkqejQUfg2hm3D0(Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;)V
+
+    return-void
+
+    :pswitch_0
+    iget-object p0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda13;->f$0:Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;
+
+    iget-object p1, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mUserTracker:Lcom/android/systemui/settings/UserTracker;
+
+    check-cast p1, Lcom/android/systemui/settings/UserTrackerImpl;
+
+    invoke-virtual {p1}, Lcom/android/systemui/settings/UserTrackerImpl;->getUserId()I
+
+    move-result p1
+
+    invoke-virtual {p0, p1}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->updateBiometricsOptionState(I)Z
+
+    move-result p1
+
+    if-eqz p1, :cond_0
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->dispatchLockModeChanged()V
+
+    :cond_0
+    sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY:Z
+
+    if-eqz p1, :cond_1
+
+    const/4 p1, 0x2
+
+    invoke-virtual {p0, p1}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->updateFingerprintListeningState(I)V
+
+    :cond_1
+    return-void
+
+    nop
+
+    :pswitch_data_0
+    .packed-switch 0x0
+        :pswitch_0
+    .end packed-switch
+.end method
diff --git a/smali/com/android/keyguard/KeyguardSecUpdateMonitorImpl.smali b/smali/com/android/keyguard/KeyguardSecUpdateMonitorImpl.smali
index c0fa2949..962ec5e1 100644
--- a/smali/com/android/keyguard/KeyguardSecUpdateMonitorImpl.smali
+++ b/smali/com/android/keyguard/KeyguardSecUpdateMonitorImpl.smali
@@ -260,6 +260,47 @@
     return-void
 .end method
 
+.method public static $r8$lambda$kJTDZ_s3Y5_-kkqejQUfg2hm3D0(Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;)V
+    .locals 1
+
+    const/4 v0, 0x2
+
+    invoke-virtual {p0, v0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->updateFingerprintListeningState(I)V
+
+    sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz v0, :cond_1
+
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mSettingsHelper:Lcom/android/systemui/util/SettingsHelper;
+
+    invoke-virtual {v0}, Lcom/android/systemui/util/SettingsHelper;->isOneHandModeRunning()Z
+
+    move-result v0
+
+    if-eqz v0, :cond_0
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->removeMaskViewForOpticalFpSensor()V
+
+    goto :goto_0
+
+    :cond_0
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardUpdateMonitor;->isFingerprintDetectionRunning()Z
+
+    move-result v0
+
+    if-eqz v0, :cond_1
+
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpMaskToken:Landroid/os/IBinder;
+
+    if-nez v0, :cond_1
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->addMaskViewForOpticalFpSensor()V
+
+    :cond_1
+    :goto_0
+    return-void
+.end method
+
 .method public static bridge synthetic -$$Nest$fgetmSettingsHelper(Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;)Lcom/android/systemui/util/SettingsHelper;
     .locals 0
 
@@ -1078,6 +1119,41 @@
     return-void
 .end method
 
+.method public final addMaskViewForOpticalFpSensor()V
+    .locals 2
+
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpm:Landroid/hardware/fingerprint/FingerprintManager;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpMaskToken:Landroid/os/IBinder;
+
+    if-nez v0, :cond_0
+
+    const-string v0, "KeyguardFingerprint"
+
+    const-string v1, "semAddMaskView()"
+
+    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
+
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpm:Landroid/hardware/fingerprint/FingerprintManager;
+
+    invoke-virtual {v0}, Landroid/hardware/fingerprint/FingerprintManager;->semAddMaskView()Landroid/os/IBinder;
+
+    move-result-object v0
+
+    iput-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpMaskToken:Landroid/os/IBinder;
+
+    const/4 v0, 0x1
+
+    const/4 v1, 0x3
+
+    invoke-virtual {p0, v1, v0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->setFocusForBiometrics(IZ)V
+
+    :cond_0
+    return-void
+.end method
+
 .method public final checkValidPrevCredentialType()Z
     .locals 2
 
@@ -4821,60 +4897,67 @@
 .method public final handleFaceAuthenticated(IZ)V
     .locals 3
 
-    const/4 v0, 0x0
-
-    iget-object v1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mSettingsHelper:Lcom/android/systemui/util/SettingsHelper;
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mSettingsHelper:Lcom/android/systemui/util/SettingsHelper;
 
-    invoke-virtual {v1}, Lcom/android/systemui/util/SettingsHelper;->isEnabledFaceStayOnLock()Z
+    invoke-virtual {v0}, Lcom/android/systemui/util/SettingsHelper;->isEnabledFaceStayOnLock()Z
 
-    move-result v1
+    move-result v0
 
-    if-eqz v1, :cond_0
+    if-eqz v0, :cond_0
 
-    iget-object v1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mBiometricFailedAttempts:Landroid/util/SparseIntArray;
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mBiometricFailedAttempts:Landroid/util/SparseIntArray;
 
-    iget-object v2, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mUserTracker:Lcom/android/systemui/settings/UserTracker;
+    iget-object v1, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mUserTracker:Lcom/android/systemui/settings/UserTracker;
 
-    check-cast v2, Lcom/android/systemui/settings/UserTrackerImpl;
+    check-cast v1, Lcom/android/systemui/settings/UserTrackerImpl;
 
-    invoke-virtual {v2}, Lcom/android/systemui/settings/UserTrackerImpl;->getUserId()I
+    invoke-virtual {v1}, Lcom/android/systemui/settings/UserTrackerImpl;->getUserId()I
 
-    move-result v2
+    move-result v1
 
-    invoke-virtual {v1, v2}, Landroid/util/SparseIntArray;->delete(I)V
+    invoke-virtual {v0, v1}, Landroid/util/SparseIntArray;->delete(I)V
 
     goto :goto_0
 
     :cond_0
-    sget-object v1, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz v0, :cond_1
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->removeMaskViewForOpticalFpSensor()V
 
+    :cond_1
     :goto_0
-    sget-boolean v1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY:Z
+    sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY:Z
 
-    if-eqz v1, :cond_1
+    if-eqz v0, :cond_2
 
-    iget v1, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mFingerprintRunningState:I
+    iget v0, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mFingerprintRunningState:I
 
-    const/4 v2, 0x1
+    const/4 v1, 0x1
 
-    if-ne v1, v2, :cond_1
+    if-ne v0, v1, :cond_2
 
-    const-string v1, "KeyguardFingerprint"
+    const-string v0, "KeyguardFingerprint"
 
-    const-string v2, "Face onAuthenticationSucceeded. FP will be stop!"
+    const-string v1, "Face onAuthenticationSucceeded. FP will be stop!"
 
-    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
+    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
 
     invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->stopListeningForFingerprint()V
 
-    :cond_1
-    new-instance v1, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda29;
+    :cond_2
+    new-instance v0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda30;
 
-    invoke-direct {v1, v0, p2, p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda29;-><init>(IZLjava/lang/Object;)V
+    const/4 v1, 0x0
 
-    const-string v2, "onBiometricAuthenticated"
+    invoke-direct {v0, v1, p2, p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda30;-><init>(IZLjava/lang/Object;)V
 
-    invoke-virtual {p0, v1, v2}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->dispatchCallback(Ljava/util/function/Consumer;Ljava/lang/String;)V
+    const-string v1, "onBiometricAuthenticated"
+
+    invoke-virtual {p0, v0, v1}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->dispatchCallback(Ljava/util/function/Consumer;Ljava/lang/String;)V
+
+    const/4 v0, 0x0
 
     invoke-virtual {p0, v0}, Lcom/android/keyguard/KeyguardUpdateMonitor;->setFaceRunningState(I)V
 
@@ -4888,11 +4971,11 @@
 
     sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_SUB_DISPLAY_COVER:Z
 
-    if-eqz p1, :cond_2
+    if-eqz p1, :cond_3
 
     iput-boolean v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mNeedSubBioAuth:Z
 
-    :cond_2
+    :cond_3
     return-void
 .end method
 
@@ -5321,9 +5404,33 @@
     invoke-virtual {v0, v2}, Landroid/util/SparseIntArray;->delete(I)V
 
     :cond_1
+    sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz v0, :cond_3
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->is2StepVerification()Z
+
+    move-result v0
+
+    if-nez v0, :cond_2
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->isForcedLock()Z
+
+    move-result v0
+
+    if-nez v0, :cond_2
+
+    iget-boolean v0, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mKeyguardShowing:Z
+
+    if-nez v0, :cond_3
+
+    :cond_2
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->removeMaskViewForOpticalFpSensor()V
+
+    :cond_3
     sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_SUB_DISPLAY_COVER:Z
 
-    if-eqz v0, :cond_2
+    if-eqz v0, :cond_4
 
     iput-boolean v1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mForceStartFinger:Z
 
@@ -5331,7 +5438,7 @@
 
     iput-boolean v1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mNeedSubWofFpAuth:Z
 
-    :cond_2
+    :cond_4
     invoke-super {p0, p1, p2}, Lcom/android/keyguard/KeyguardUpdateMonitor;->handleFingerprintAuthenticated(IZ)V
 
     return-void
@@ -5376,7 +5483,7 @@
 
     iget-object p2, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mContext:Landroid/content/Context;
 
-    const v0, 0x7f1308c3
+    const v0, 0x7f1308c4
 
     invoke-virtual {p2, v0}, Landroid/content/Context;->getString(I)Ljava/lang/String;
 
@@ -5387,7 +5494,7 @@
     :cond_2
     const/16 v0, 0x3ea
 
-    if-eq v0, p1, :cond_5
+    if-eq v0, p1, :cond_6
 
     const/16 v0, 0x3eb
 
@@ -5398,13 +5505,15 @@
     :cond_3
     const/16 v0, 0x3e9
 
-    if-ne v0, p1, :cond_4
+    if-ne v0, p1, :cond_5
 
-    sget-object p2, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    sget-boolean p2, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz p2, :cond_4
 
     iget-object p2, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mContext:Landroid/content/Context;
 
-    const v0, 0x7f1308c8
+    const v0, 0x7f1308c6
 
     invoke-virtual {p2, v0}, Landroid/content/Context;->getString(I)Ljava/lang/String;
 
@@ -5413,13 +5522,24 @@
     goto :goto_1
 
     :cond_4
+    iget-object p2, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mContext:Landroid/content/Context;
+
+    const v0, 0x7f1308c9
+
+    invoke-virtual {p2, v0}, Landroid/content/Context;->getString(I)Ljava/lang/String;
+
+    move-result-object p2
+
+    goto :goto_1
+
+    :cond_5
     const/16 v0, 0x3ed
 
-    if-ne v0, p1, :cond_6
+    if-ne v0, p1, :cond_7
 
     iget-object p2, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mContext:Landroid/content/Context;
 
-    const v0, 0x7f1308c6
+    const v0, 0x7f1308c7
 
     invoke-virtual {p2, v0}, Landroid/content/Context;->getString(I)Ljava/lang/String;
 
@@ -5427,17 +5547,17 @@
 
     goto :goto_1
 
-    :cond_5
+    :cond_6
     :goto_0
     iget-object p2, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mContext:Landroid/content/Context;
 
-    const v0, 0x7f1308c4
+    const v0, 0x7f1308c5
 
     invoke-virtual {p2, v0}, Landroid/content/Context;->getString(I)Ljava/lang/String;
 
     move-result-object p2
 
-    :cond_6
+    :cond_7
     :goto_1
     iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mPowerManager:Landroid/os/PowerManager;
 
@@ -5451,21 +5571,21 @@
 
     sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_BACKGROUND_AUTHENTICATION:Z
 
-    if-eqz v0, :cond_7
+    if-eqz v0, :cond_8
 
     const/4 v0, 0x5
 
-    if-ne p1, v0, :cond_7
+    if-ne p1, v0, :cond_8
 
     iget-boolean v0, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mKeyguardOccluded:Z
 
-    if-eqz v0, :cond_7
+    if-eqz v0, :cond_8
 
     iget v0, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mFingerprintRunningState:I
 
     const/4 v3, 0x1
 
-    if-ne v0, v3, :cond_7
+    if-ne v0, v3, :cond_8
 
     const-string v0, "mIsFPCanceledByForegroundApp true"
 
@@ -5475,7 +5595,7 @@
 
     invoke-virtual {p0, v1}, Lcom/android/keyguard/KeyguardUpdateMonitor;->setFingerprintRunningState(I)V
 
-    :cond_7
+    :cond_8
     invoke-super {p0, p1, p2}, Lcom/android/keyguard/KeyguardUpdateMonitor;->handleFingerprintError(ILjava/lang/String;)V
 
     return-void
@@ -12274,6 +12394,37 @@
     return-void
 .end method
 
+.method public final removeMaskViewForOpticalFpSensor()V
+    .locals 2
+
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpm:Landroid/hardware/fingerprint/FingerprintManager;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpMaskToken:Landroid/os/IBinder;
+
+    if-eqz v0, :cond_0
+
+    const-string v0, "KeyguardFingerprint"
+
+    const-string v1, "semRemoveMaskView()"
+
+    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
+
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpm:Landroid/hardware/fingerprint/FingerprintManager;
+
+    iget-object v1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpMaskToken:Landroid/os/IBinder;
+
+    invoke-virtual {v0, v1}, Landroid/hardware/fingerprint/FingerprintManager;->semRemoveMaskView(Landroid/os/IBinder;)I
+
+    const/4 v0, 0x0
+
+    iput-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpMaskToken:Landroid/os/IBinder;
+
+    :cond_0
+    return-void
+.end method
+
 .method public final reportFailedBiometricUnlockAttempt(I)V
     .locals 9
 
@@ -12451,18 +12602,23 @@
 
     move-result v0
 
+    if-eqz v0, :cond_1
+
+    sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
     if-eqz v0, :cond_0
 
-    sget-object v0, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->removeMaskViewForOpticalFpSensor()V
 
+    :cond_0
     invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->stopListeningForFingerprint()V
 
     goto :goto_0
 
-    :cond_0
+    :cond_1
     iget-object v0, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mFingerprintCancelSignal:Landroid/os/CancellationSignal;
 
-    if-eqz v0, :cond_1
+    if-eqz v0, :cond_2
 
     invoke-virtual {v0}, Landroid/os/CancellationSignal;->cancel()V
 
@@ -12470,7 +12626,7 @@
 
     iput-object v0, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mFingerprintCancelSignal:Landroid/os/CancellationSignal;
 
-    :cond_1
+    :cond_2
     :goto_0
     sget-object v0, Lcom/android/systemui/Dependency;->sDependency:Lcom/android/systemui/Dependency;
 
@@ -12482,11 +12638,11 @@
 
     check-cast v0, Lcom/android/systemui/UiOffloadThread;
 
-    new-instance v1, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda14;
+    new-instance v1, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda15;
 
     const/16 v2, 0x8
 
-    invoke-direct {v1, p0, v2}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda14;-><init>(Ljava/lang/Object;I)V
+    invoke-direct {v1, p0, v2}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda15;-><init>(Ljava/lang/Object;I)V
 
     invoke-virtual {v0, v1}, Lcom/android/systemui/UiOffloadThread;->execute(Ljava/lang/Runnable;)V
 
@@ -12568,6 +12724,33 @@
     return-void
 .end method
 
+.method public final semSetScreenStatus()V
+    .locals 2
+
+    sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpMaskToken:Landroid/os/IBinder;
+
+    if-eqz v0, :cond_0
+
+    const-string v0, "semSetScreenStatus : 1"
+
+    const-string v1, "KeyguardFingerprint"
+
+    invoke-static {v1, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
+
+    iget-object p0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpm:Landroid/hardware/fingerprint/FingerprintManager;
+
+    const/4 v0, 0x1
+
+    invoke-virtual {p0, v0}, Landroid/hardware/fingerprint/FingerprintManager;->semSetScreenStatus(I)I
+
+    :cond_0
+    return-void
+.end method
+
 .method public final sendBiometricUnlockState(Landroid/hardware/biometrics/BiometricSourceType;)V
     .locals 4
 
@@ -13866,7 +14049,7 @@
 .end method
 
 .method public final setUnlockingKeyguard(Z)V
-    .locals 2
+    .locals 3
 
     iget-boolean v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mKeyguardUnlocking:Z
 
@@ -13875,29 +14058,17 @@
     return-void
 
     :cond_0
-    new-instance v0, Ljava/lang/StringBuilder;
-
-    const-string v1, "setUnlockingKeyguard( "
-
-    invoke-direct {v0, v1}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
-
-    invoke-virtual {v0, p1}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
+    const-string v0, "setUnlockingKeyguard( "
 
     const-string v1, " )"
 
-    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
-
-    move-result-object v0
-
-    const-string v1, "KeyguardUpdateMonitor"
+    const-string v2, "KeyguardUpdateMonitor"
 
-    invoke-static {v1, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
+    invoke-static {v0, v1, v2, p1}, Lcom/android/keyguard/KeyguardSecSecurityContainerController$$ExternalSyntheticOutline0;->m(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Z)V
 
     iput-boolean p1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mKeyguardUnlocking:Z
 
-    if-eqz p1, :cond_1
+    if-eqz p1, :cond_2
 
     invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->stopListeningForFingerprint()V
 
@@ -13905,19 +14076,24 @@
 
     invoke-virtual {p0, p1}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->stopListeningForFace(Lcom/android/systemui/deviceentry/shared/FaceAuthUiEvent;)V
 
-    sget-object p1, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
 
-    new-instance p1, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda10;
+    if-eqz p1, :cond_1
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->removeMaskViewForOpticalFpSensor()V
+
+    :cond_1
+    new-instance p1, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda11;
 
     const/4 v0, 0x0
 
-    invoke-direct {p1, v0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda10;-><init>(I)V
+    invoke-direct {p1, v0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticLambda11;-><init>(I)V
 
     const/4 v0, 0x0
 
     invoke-virtual {p0, p1, v0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->dispatchCallback(Ljava/util/function/Consumer;Ljava/lang/String;)V
 
-    :cond_1
+    :cond_2
     return-void
 .end method
 
@@ -17029,7 +17205,7 @@
 .end method
 
 .method public final updateFingerprintListeningState(I)V
-    .locals 7
+    .locals 8
 
     const/4 v0, 0x0
 
@@ -17067,17 +17243,11 @@
 
     iget v5, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mFingerprintRunningState:I
 
-    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
+    const-string v6, " shouldListenForFingerprint="
 
-    const-string v5, " shouldListenForFingerprint="
+    const-string v7, " isUdfpsEnrolled=false bioType : "
 
-    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    invoke-virtual {v4, v1}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
-
-    const-string v5, " isUdfpsEnrolled=false bioType : "
-
-    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    invoke-static {v4, v5, v6, v1, v7}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl$$ExternalSyntheticOutline0;->m(Ljava/lang/StringBuilder;ILjava/lang/String;ZLjava/lang/String;)V
 
     iget-object v5, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mSelectedUserInteractor:Lcom/android/systemui/user/domain/interactor/SelectedUserInteractor;
 
@@ -17101,9 +17271,9 @@
 
     invoke-static {v5, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
 
-    if-eqz v2, :cond_3
+    if-eqz v2, :cond_4
 
-    if-nez v1, :cond_3
+    if-nez v1, :cond_4
 
     if-nez p1, :cond_2
 
@@ -17112,72 +17282,124 @@
     :cond_2
     iget p1, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mFingerprintRunningState:I
 
-    if-ne p1, v3, :cond_6
+    if-ne p1, v3, :cond_8
+
+    sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz p1, :cond_3
+
+    iget-boolean p1, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mKeyguardShowing:Z
+
+    if-nez p1, :cond_3
 
-    sget-object p1, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->removeMaskViewForOpticalFpSensor()V
 
+    :cond_3
     invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->stopListeningForFingerprint()V
 
     goto :goto_2
 
-    :cond_3
-    if-nez v2, :cond_5
+    :cond_4
+    if-nez v2, :cond_7
 
-    if-eqz v1, :cond_5
+    if-eqz v1, :cond_7
 
-    if-ne p1, v3, :cond_4
+    if-ne p1, v3, :cond_5
 
     return-void
 
-    :cond_4
-    sget-object p1, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    :cond_5
+    sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz p1, :cond_6
+
+    iget-object p1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mSettingsHelper:Lcom/android/systemui/util/SettingsHelper;
+
+    invoke-virtual {p1}, Lcom/android/systemui/util/SettingsHelper;->isOneHandModeRunning()Z
 
+    move-result p1
+
+    if-nez p1, :cond_6
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->addMaskViewForOpticalFpSensor()V
+
+    :cond_6
     invoke-virtual {p0, v0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->startListeningForFingerprint(Z)V
 
     goto :goto_2
 
-    :cond_5
-    if-nez v2, :cond_6
+    :cond_7
+    if-nez v2, :cond_8
 
-    if-nez v1, :cond_6
+    if-nez v1, :cond_8
 
-    sget-object p1, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
 
-    :cond_6
+    if-eqz p1, :cond_8
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->isFingerprintOptionEnabled()Z
+
+    move-result p1
+
+    if-eqz p1, :cond_8
+
+    sget-boolean p1, Lcom/android/systemui/LsRune;->COVER_SUPPORTED:Z
+
+    if-eqz p1, :cond_8
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->isCoverClosed()Z
+
+    move-result p1
+
+    if-eqz p1, :cond_8
+
+    iget-boolean p1, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mKeyguardShowing:Z
+
+    if-eqz p1, :cond_8
+
+    invoke-virtual {p0}, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->addMaskViewForOpticalFpSensor()V
+
+    :cond_8
     :goto_2
     sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY:Z
 
-    if-eqz p1, :cond_9
+    if-eqz p1, :cond_b
 
-    if-nez v1, :cond_7
+    if-nez v1, :cond_9
 
-    goto :goto_3
+    sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
 
-    :cond_7
+    if-eqz p1, :cond_b
+
+    iget-object p1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpMaskToken:Landroid/os/IBinder;
+
+    if-eqz p1, :cond_b
+
+    :cond_9
     iget-boolean p1, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mDeviceInteractive:Z
 
-    if-eqz p1, :cond_8
+    if-eqz p1, :cond_a
 
     iget-boolean p1, p0, Lcom/android/keyguard/KeyguardUpdateMonitor;->mGoingToSleep:Z
 
-    if-nez p1, :cond_8
+    if-nez p1, :cond_a
 
     iget-boolean p1, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mIsDreamingForBiometrics:Z
 
-    if-nez p1, :cond_8
+    if-nez p1, :cond_a
 
     move v0, v3
 
-    :cond_8
+    :cond_a
     xor-int/lit8 p1, v0, 0x1
 
     iget v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpInDisplayState:I
 
-    if-eq v0, p1, :cond_9
+    if-eq v0, p1, :cond_b
 
     iget-object v0, p0, Lcom/android/keyguard/KeyguardSecUpdateMonitorImpl;->mFpm:Landroid/hardware/fingerprint/FingerprintManager;
 
-    if-eqz v0, :cond_9
+    if-eqz v0, :cond_b
 
     new-instance v0, Ljava/lang/StringBuilder;
 
@@ -17197,8 +17419,7 @@
 
     invoke-virtual {p0, p1}, Landroid/hardware/fingerprint/FingerprintManager;->semSetScreenStatus(I)I
 
-    :cond_9
-    :goto_3
+    :cond_b
     return-void
 .end method
 
diff --git a/smali/com/android/systemui/LsRune.smali b/smali/com/android/systemui/LsRune.smali
index 5a4e2d19..14121660 100644
--- a/smali/com/android/systemui/LsRune.smali
+++ b/smali/com/android/systemui/LsRune.smali
@@ -122,6 +122,8 @@
 
 .field public static final SECURITY_FINGERPRINT_IN_DISPLAY:Z
 
+.field public static final SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
 .field public static final SECURITY_HAPTIC_FEEDBACK_ON_DC_MOTOR:Z
 
 .field public static final SECURITY_NAVBAR_ENABLED:Z
@@ -672,6 +674,8 @@
 
     sput-boolean v2, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY:Z
 
+    sput-boolean v2, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
     sput-boolean v3, Lcom/android/systemui/LsRune;->SECURITY_BACKGROUND_AUTHENTICATION:Z
 
     const-string v2, "SEC_FLOATING_FEATURE_LOCKSCREEN_CONFIG_PUNCHHOLE_VI"
diff --git a/smali_classes2/com/android/systemui/doze/DozeScreenState.smali b/smali_classes2/com/android/systemui/doze/DozeScreenState.smali
index 4238d225..3fb505ae 100644
--- a/smali_classes2/com/android/systemui/doze/DozeScreenState.smali
+++ b/smali_classes2/com/android/systemui/doze/DozeScreenState.smali
@@ -338,38 +338,38 @@
 .method public final transitionTo(Lcom/android/systemui/doze/DozeMachine$State;Lcom/android/systemui/doze/DozeMachine$State;)V
     .locals 12
 
-    const/4 v0, 0x1
-
     invoke-virtual {p2}, Ljava/lang/Enum;->ordinal()I
 
-    move-result v1
+    move-result v0
+
+    const/4 v1, 0x0
 
-    const/4 v2, 0x0
+    const/4 v2, 0x1
 
     iget-object v3, p0, Lcom/android/systemui/doze/DozeScreenState;->mParameters:Lcom/android/systemui/statusbar/phone/DozeParameters;
 
     const/4 v4, 0x2
 
-    packed-switch v1, :pswitch_data_0
+    packed-switch v0, :pswitch_data_0
 
     :pswitch_0
-    move v4, v2
+    move v4, v1
 
     goto :goto_1
 
     :pswitch_1
     invoke-virtual {v3}, Lcom/android/systemui/statusbar/phone/DozeParameters;->getDisplayNeedsBlanking()Z
 
-    move-result v1
+    move-result v0
 
-    if-eqz v1, :cond_2
+    if-eqz v0, :cond_2
 
     goto :goto_0
 
     :pswitch_2
-    sget-boolean v1, Lcom/android/systemui/LsRune;->AOD_DOZE_AP_SLEEP:Z
+    sget-boolean v0, Lcom/android/systemui/LsRune;->AOD_DOZE_AP_SLEEP:Z
 
-    if-eqz v1, :cond_0
+    if-eqz v0, :cond_0
 
     const/4 v4, 0x3
 
@@ -383,31 +383,31 @@
     :cond_1
     :goto_0
     :pswitch_3
-    move v4, v0
+    move v4, v2
 
     goto :goto_1
 
     :pswitch_4
-    iget-boolean v1, v3, Lcom/android/systemui/statusbar/phone/DozeParameters;->mControlScreenOffAnimation:Z
+    iget-boolean v0, v3, Lcom/android/systemui/statusbar/phone/DozeParameters;->mControlScreenOffAnimation:Z
 
-    if-eqz v1, :cond_1
+    if-eqz v0, :cond_1
 
     :cond_2
     :goto_1
     :pswitch_5
-    iget-object v1, p0, Lcom/android/systemui/doze/DozeScreenState;->mDozeHost:Lcom/android/systemui/doze/DozeHost;
+    iget-object v0, p0, Lcom/android/systemui/doze/DozeScreenState;->mDozeHost:Lcom/android/systemui/doze/DozeHost;
 
-    check-cast v1, Lcom/android/systemui/statusbar/phone/DozeServiceHost;
+    check-cast v0, Lcom/android/systemui/statusbar/phone/DozeServiceHost;
 
     const/4 v5, 0x0
 
-    iput-object v5, v1, Lcom/android/systemui/statusbar/phone/DozeServiceHost;->mPendingScreenOffCallback:Ljava/lang/Runnable;
+    iput-object v5, v0, Lcom/android/systemui/statusbar/phone/DozeServiceHost;->mPendingScreenOffCallback:Ljava/lang/Runnable;
 
-    iget-object v5, v1, Lcom/android/systemui/statusbar/phone/DozeServiceHost;->mHasPendingScreenOffCallbackChangeListener:Lcom/android/systemui/statusbar/phone/DozeServiceHost$HasPendingScreenOffCallbackChangeListener;
+    iget-object v5, v0, Lcom/android/systemui/statusbar/phone/DozeServiceHost;->mHasPendingScreenOffCallbackChangeListener:Lcom/android/systemui/statusbar/phone/DozeServiceHost$HasPendingScreenOffCallbackChangeListener;
 
-    invoke-interface {v5, v2}, Lcom/android/systemui/statusbar/phone/DozeServiceHost$HasPendingScreenOffCallbackChangeListener;->onHasPendingScreenOffCallbackChanged(Z)V
+    invoke-interface {v5, v1}, Lcom/android/systemui/statusbar/phone/DozeServiceHost$HasPendingScreenOffCallbackChangeListener;->onHasPendingScreenOffCallbackChanged(Z)V
 
-    iget-object v5, v1, Lcom/android/systemui/statusbar/phone/DozeServiceHost;->mScrimController:Lcom/android/systemui/statusbar/phone/ScrimController;
+    iget-object v5, v0, Lcom/android/systemui/statusbar/phone/DozeServiceHost;->mScrimController:Lcom/android/systemui/statusbar/phone/ScrimController;
 
     iget-object v5, v5, Lcom/android/systemui/statusbar/phone/ScrimController;->mState:Lcom/android/systemui/statusbar/phone/ScrimState;
 
@@ -415,14 +415,14 @@
 
     if-ne v5, v6, :cond_3
 
-    iget-object v1, v1, Lcom/android/systemui/statusbar/phone/DozeServiceHost;->mCentralSurfaces:Lcom/android/systemui/statusbar/phone/CentralSurfaces;
+    iget-object v0, v0, Lcom/android/systemui/statusbar/phone/DozeServiceHost;->mCentralSurfaces:Lcom/android/systemui/statusbar/phone/CentralSurfaces;
 
-    check-cast v1, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;
+    check-cast v0, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;
 
-    invoke-virtual {v1}, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->updateScrimController()V
+    invoke-virtual {v0}, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->updateScrimController()V
 
     :cond_3
-    sget-object v1, Lcom/android/systemui/doze/DozeMachine$State;->FINISH:Lcom/android/systemui/doze/DozeMachine$State;
+    sget-object v0, Lcom/android/systemui/doze/DozeMachine$State;->FINISH:Lcom/android/systemui/doze/DozeMachine$State;
 
     iget-object v5, p0, Lcom/android/systemui/doze/DozeScreenState;->mWakeLock:Lcom/android/systemui/util/wakelock/SettableWakeLock;
 
@@ -430,13 +430,13 @@
 
     iget-object v7, p0, Lcom/android/systemui/doze/DozeScreenState;->mHandler:Landroid/os/Handler;
 
-    if-ne p2, v1, :cond_5
+    if-ne p2, v0, :cond_5
 
-    iput v2, p0, Lcom/android/systemui/doze/DozeScreenState;->mPendingScreenState:I
+    iput v1, p0, Lcom/android/systemui/doze/DozeScreenState;->mPendingScreenState:I
 
     invoke-virtual {v7, v6}, Landroid/os/Handler;->removeCallbacks(Ljava/lang/Runnable;)V
 
-    invoke-virtual {p0, v4, v2}, Lcom/android/systemui/doze/DozeScreenState;->applyScreenState(IZ)V
+    invoke-virtual {p0, v4, v1}, Lcom/android/systemui/doze/DozeScreenState;->applyScreenState(IZ)V
 
     iget-object p1, p0, Lcom/android/systemui/doze/DozeScreenState;->mPluginAODManagerLazy:Ldagger/Lazy;
 
@@ -446,7 +446,7 @@
 
     check-cast p1, Lcom/android/systemui/doze/PluginAODManager;
 
-    invoke-virtual {p1, v0}, Lcom/android/systemui/doze/PluginAODManager;->enableTouch(Z)V
+    invoke-virtual {p1, v2}, Lcom/android/systemui/doze/PluginAODManager;->enableTouch(Z)V
 
     iget-object p1, p0, Lcom/android/systemui/doze/DozeScreenState;->mPluginAODManagerLazy:Ldagger/Lazy;
 
@@ -456,7 +456,7 @@
 
     check-cast p1, Lcom/android/systemui/doze/PluginAODManager;
 
-    iput-boolean v2, p1, Lcom/android/systemui/doze/PluginAODManager;->mClockTransitionStarted:Z
+    iput-boolean v1, p1, Lcom/android/systemui/doze/PluginAODManager;->mClockTransitionStarted:Z
 
     sget-boolean p1, Lcom/android/systemui/LsRune;->AOD_FULLSCREEN:Z
 
@@ -470,10 +470,10 @@
 
     check-cast p0, Lcom/android/systemui/doze/PluginAODManager;
 
-    invoke-virtual {p0, v2}, Lcom/android/systemui/doze/PluginAODManager;->updateRefreshRate(I)V
+    invoke-virtual {p0, v1}, Lcom/android/systemui/doze/PluginAODManager;->updateRefreshRate(I)V
 
     :cond_4
-    invoke-virtual {v5, v2}, Lcom/android/systemui/util/wakelock/SettableWakeLock;->setAcquired(Z)V
+    invoke-virtual {v5, v1}, Lcom/android/systemui/util/wakelock/SettableWakeLock;->setAcquired(Z)V
 
     return-void
 
@@ -483,11 +483,11 @@
     return-void
 
     :cond_6
-    sget-object v1, Lcom/android/systemui/doze/DozeMachine$State;->INITIALIZED:Lcom/android/systemui/doze/DozeMachine$State;
+    sget-object v0, Lcom/android/systemui/doze/DozeMachine$State;->INITIALIZED:Lcom/android/systemui/doze/DozeMachine$State;
 
     const-string v8, "DozeScreenState"
 
-    if-ne p2, v1, :cond_7
+    if-ne p2, v0, :cond_7
 
     iget-boolean v9, v3, Lcom/android/systemui/statusbar/phone/DozeParameters;->mControlScreenOffAnimation:Z
 
@@ -498,7 +498,7 @@
     goto :goto_2
 
     :cond_7
-    move v9, v2
+    move v9, v1
 
     :goto_2
     invoke-virtual {v7, v6}, Landroid/os/Handler;->hasCallbacks(Ljava/lang/Runnable;)Z
@@ -518,22 +518,22 @@
     if-ne p2, v11, :cond_9
 
     :cond_8
-    move v11, v0
+    move v11, v2
 
     goto :goto_3
 
     :cond_9
-    move v11, v2
+    move v11, v1
 
     :goto_3
-    if-ne p1, v1, :cond_a
+    if-ne p1, v0, :cond_a
 
-    move p1, v0
+    move p1, v2
 
     goto :goto_4
 
     :cond_a
-    move p1, v2
+    move p1, v1
 
     :goto_4
     if-nez v10, :cond_b
@@ -548,7 +548,7 @@
 
     if-ne p2, p1, :cond_16
 
-    iput-boolean v0, p0, Lcom/android/systemui/doze/DozeScreenState;->mIsExecutedClockTransition:Z
+    iput-boolean v2, p0, Lcom/android/systemui/doze/DozeScreenState;->mIsExecutedClockTransition:Z
 
     iget-object p1, p0, Lcom/android/systemui/doze/DozeScreenState;->mPluginAODManagerLazy:Ldagger/Lazy;
 
@@ -558,7 +558,7 @@
 
     check-cast p1, Lcom/android/systemui/doze/PluginAODManager;
 
-    invoke-virtual {p1, v0}, Lcom/android/systemui/doze/PluginAODManager;->enableTouch(Z)V
+    invoke-virtual {p1, v2}, Lcom/android/systemui/doze/PluginAODManager;->enableTouch(Z)V
 
     goto/16 :goto_b
 
@@ -584,19 +584,19 @@
 
     iget-object p1, p1, Lcom/android/systemui/statusbar/phone/ScreenOffAnimationController;->animations:Ljava/util/List;
 
-    instance-of v1, p1, Ljava/util/Collection;
+    instance-of v0, p1, Ljava/util/Collection;
 
-    if-eqz v1, :cond_d
+    if-eqz v0, :cond_d
 
-    move-object v1, p1
+    move-object v0, p1
 
-    check-cast v1, Ljava/util/ArrayList;
+    check-cast v0, Ljava/util/ArrayList;
 
-    invoke-virtual {v1}, Ljava/util/ArrayList;->isEmpty()Z
+    invoke-virtual {v0}, Ljava/util/ArrayList;->isEmpty()Z
 
-    move-result v1
+    move-result v0
 
-    if-eqz v1, :cond_d
+    if-eqz v0, :cond_d
 
     goto :goto_6
 
@@ -610,50 +610,50 @@
     :cond_e
     invoke-interface {p1}, Ljava/util/Iterator;->hasNext()Z
 
-    move-result v1
+    move-result v0
 
-    if-eqz v1, :cond_f
+    if-eqz v0, :cond_f
 
     invoke-interface {p1}, Ljava/util/Iterator;->next()Ljava/lang/Object;
 
-    move-result-object v1
+    move-result-object v0
 
-    check-cast v1, Lcom/android/systemui/statusbar/phone/ScreenOffAnimation;
+    check-cast v0, Lcom/android/systemui/statusbar/phone/ScreenOffAnimation;
 
-    invoke-interface {v1}, Lcom/android/systemui/statusbar/phone/ScreenOffAnimation;->shouldDelayDisplayDozeTransition()Z
+    invoke-interface {v0}, Lcom/android/systemui/statusbar/phone/ScreenOffAnimation;->shouldDelayDisplayDozeTransition()Z
 
-    move-result v1
+    move-result v0
 
-    if-eqz v1, :cond_e
+    if-eqz v0, :cond_e
 
     :goto_5
-    move p1, v0
+    move p1, v2
 
     goto :goto_7
 
     :cond_f
     :goto_6
-    move p1, v2
+    move p1, v1
 
     :goto_7
-    sget-object v1, Lcom/android/systemui/doze/DozeMachine$State;->DOZE_AOD:Lcom/android/systemui/doze/DozeMachine$State;
+    sget-object v0, Lcom/android/systemui/doze/DozeMachine$State;->DOZE_AOD:Lcom/android/systemui/doze/DozeMachine$State;
 
-    if-ne p2, v1, :cond_10
+    if-ne p2, v0, :cond_10
 
-    iget-object v1, p0, Lcom/android/systemui/doze/DozeScreenState;->mUdfpsController:Lcom/android/systemui/biometrics/UdfpsController;
+    iget-object v0, p0, Lcom/android/systemui/doze/DozeScreenState;->mUdfpsController:Lcom/android/systemui/biometrics/UdfpsController;
 
-    if-eqz v1, :cond_10
+    if-eqz v0, :cond_10
 
-    iget-boolean v1, v1, Lcom/android/systemui/biometrics/UdfpsController;->mOnFingerDown:Z
+    iget-boolean v0, v0, Lcom/android/systemui/biometrics/UdfpsController;->mOnFingerDown:Z
 
-    if-eqz v1, :cond_10
+    if-eqz v0, :cond_10
 
-    move v1, v0
+    move v0, v2
 
     goto :goto_8
 
     :cond_10
-    move v1, v2
+    move v0, v1
 
     :goto_8
     sget-boolean v3, Lcom/android/systemui/doze/DozeScreenState;->DEBUG:Z
@@ -677,7 +677,7 @@
     goto :goto_9
 
     :cond_11
-    move v4, v0
+    move v4, v2
 
     :goto_9
     invoke-static {v4, v8, v3}, Landroidx/recyclerview/widget/RecyclerView$$ExternalSyntheticOutline0;->m(ILjava/lang/String;Ljava/lang/StringBuilder;)V
@@ -689,11 +689,13 @@
 
     if-ne p2, v3, :cond_14
 
-    iput-boolean v0, p0, Lcom/android/systemui/doze/DozeScreenState;->mIsExecutedClockTransition:Z
+    iput-boolean v2, p0, Lcom/android/systemui/doze/DozeScreenState;->mIsExecutedClockTransition:Z
 
     new-instance v3, Lcom/android/systemui/doze/DozeScreenState$$ExternalSyntheticLambda0;
 
-    invoke-direct {v3, p0, v0}, Lcom/android/systemui/doze/DozeScreenState$$ExternalSyntheticLambda0;-><init>(Lcom/android/systemui/doze/DozeScreenState;I)V
+    const/4 v4, 0x1
+
+    invoke-direct {v3, p0, v4}, Lcom/android/systemui/doze/DozeScreenState$$ExternalSyntheticLambda0;-><init>(Lcom/android/systemui/doze/DozeScreenState;I)V
 
     invoke-virtual {v7, v3}, Landroid/os/Handler;->post(Ljava/lang/Runnable;)Z
 
@@ -710,20 +712,22 @@
     :goto_a
     if-nez p1, :cond_15
 
-    if-eqz v1, :cond_16
+    if-eqz v0, :cond_16
 
     :cond_15
-    invoke-virtual {v5, v0}, Lcom/android/systemui/util/wakelock/SettableWakeLock;->setAcquired(Z)V
+    invoke-virtual {v5, v2}, Lcom/android/systemui/util/wakelock/SettableWakeLock;->setAcquired(Z)V
 
     :cond_16
     :goto_b
-    if-eqz v9, :cond_17
+    if-eqz v9, :cond_18
 
     sget-object p1, Lcom/android/systemui/doze/DozeMachine$State;->INITIALIZED:Lcom/android/systemui/doze/DozeMachine$State;
 
-    if-ne p2, p1, :cond_17
+    if-ne p2, p1, :cond_18
+
+    sget-boolean p1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
 
-    sget-object p1, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    if-eqz p1, :cond_17
 
     iget-object p1, p0, Lcom/android/systemui/doze/DozeScreenState;->mPluginAODManagerLazy:Ldagger/Lazy;
 
@@ -733,7 +737,20 @@
 
     check-cast p1, Lcom/android/systemui/doze/PluginAODManager;
 
-    invoke-virtual {p1, v2}, Lcom/android/systemui/doze/PluginAODManager;->enableTouch(Z)V
+    iget-object p1, p1, Lcom/android/systemui/doze/PluginAODManager;->mKeyguardUpdateMonitor:Lcom/android/keyguard/KeyguardUpdateMonitor;
+
+    invoke-virtual {p1}, Lcom/android/keyguard/KeyguardUpdateMonitor;->semSetScreenStatus()V
+
+    :cond_17
+    iget-object p1, p0, Lcom/android/systemui/doze/DozeScreenState;->mPluginAODManagerLazy:Ldagger/Lazy;
+
+    invoke-interface {p1}, Ldagger/Lazy;->get()Ljava/lang/Object;
+
+    move-result-object p1
+
+    check-cast p1, Lcom/android/systemui/doze/PluginAODManager;
+
+    invoke-virtual {p1, v1}, Lcom/android/systemui/doze/PluginAODManager;->enableTouch(Z)V
 
     iget-object p0, p0, Lcom/android/systemui/doze/DozeScreenState;->mPluginAODManagerLazy:Ldagger/Lazy;
 
@@ -743,9 +760,9 @@
 
     check-cast p0, Lcom/android/systemui/doze/PluginAODManager;
 
-    iput-boolean v0, p0, Lcom/android/systemui/doze/PluginAODManager;->mClockTransitionStarted:Z
+    iput-boolean v2, p0, Lcom/android/systemui/doze/PluginAODManager;->mClockTransitionStarted:Z
 
-    :cond_17
+    :cond_18
     return-void
 
     nop
diff --git a/smali_classes2/com/android/systemui/globalactions/presentation/features/GlobalActionFeatures.smali b/smali_classes2/com/android/systemui/globalactions/presentation/features/GlobalActionFeatures.smali
index e633cb0f..fd994657 100644
--- a/smali_classes2/com/android/systemui/globalactions/presentation/features/GlobalActionFeatures.smali
+++ b/smali_classes2/com/android/systemui/globalactions/presentation/features/GlobalActionFeatures.smali
@@ -306,7 +306,13 @@
 
     sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY:Z
 
-    goto/16 :goto_2
+    if-nez v0, :cond_8
+
+    sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz v0, :cond_14
+
+    goto :goto_0
 
     :cond_b
     const-string v0, "SUPPORT_SIDE_KEY"
diff --git a/smali_classes2/com/android/systemui/keyguard/KeyguardViewMediator.smali b/smali_classes2/com/android/systemui/keyguard/KeyguardViewMediator.smali
index c092323f..f821ce59 100644
--- a/smali_classes2/com/android/systemui/keyguard/KeyguardViewMediator.smali
+++ b/smali_classes2/com/android/systemui/keyguard/KeyguardViewMediator.smali
@@ -5710,10 +5710,17 @@
 
     move-result v2
 
+    if-eqz v2, :cond_1
+
+    sget-boolean v2, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
     if-eqz v2, :cond_0
 
-    sget-object v2, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    iget-object v2, p1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->updateMonitor:Lcom/android/keyguard/KeyguardUpdateMonitor;
 
+    invoke-interface {v2}, Lcom/android/keyguard/KeyguardSecUpdateMonitor;->removeMaskViewForOpticalFpSensor()V
+
+    :cond_0
     invoke-virtual {p1}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->removeShowMsg()V
 
     iget-object p1, p1, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->viewControllerLazy:Ldagger/Lazy;
@@ -5728,17 +5735,17 @@
 
     goto :goto_0
 
-    :cond_0
+    :cond_1
     move v0, v1
 
     :goto_0
-    if-eqz v0, :cond_1
+    if-eqz v0, :cond_2
 
     invoke-virtual {p0}, Lcom/android/systemui/keyguard/KeyguardViewMediator;->tryKeyguardDone$1()V
 
     goto :goto_1
 
-    :cond_1
+    :cond_2
     iget-object p1, p0, Lcom/android/systemui/keyguard/KeyguardViewMediator;->mKeyguardViewControllerLazy:Ldagger/Lazy;
 
     invoke-interface {p1}, Ldagger/Lazy;->get()Ljava/lang/Object;
diff --git a/smali_classes2/com/android/systemui/keyguard/KeyguardViewMediatorHelperImpl.smali b/smali_classes2/com/android/systemui/keyguard/KeyguardViewMediatorHelperImpl.smali
index 0e80ce6d..1e55f0d2 100644
--- a/smali_classes2/com/android/systemui/keyguard/KeyguardViewMediatorHelperImpl.smali
+++ b/smali_classes2/com/android/systemui/keyguard/KeyguardViewMediatorHelperImpl.smali
@@ -1291,19 +1291,19 @@
 
     const/4 v10, 0x0
 
-    if-eq v1, v2, :cond_54
+    if-eq v1, v2, :cond_55
 
     const/16 v2, 0x44e
 
-    if-eq v1, v2, :cond_50
+    if-eq v1, v2, :cond_51
 
     const/16 v2, 0x4b1
 
-    if-eq v1, v2, :cond_4c
+    if-eq v1, v2, :cond_4d
 
     const/16 v2, 0x515
 
-    if-eq v1, v2, :cond_4b
+    if-eq v1, v2, :cond_4c
 
     packed-switch v1, :pswitch_data_0
 
@@ -1312,7 +1312,7 @@
     :pswitch_0
     sget-boolean v1, Lcom/android/systemui/LsRune;->SUBSCREEN_LARGE_FRONT_SUB_DISPLAY:Z
 
-    if-eqz v1, :cond_57
+    if-eqz v1, :cond_58
 
     iget-object v1, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->subScreenManager:Lcom/android/systemui/subscreen/SubScreenManager;
 
@@ -1573,7 +1573,7 @@
 
     const-string v15, "KeyguardViewMediator"
 
-    if-eqz v0, :cond_1e
+    if-eqz v0, :cond_1f
 
     invoke-virtual {v8, v13}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->isDisabledUnlockAnimation(Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;)Z
 
@@ -1699,20 +1699,12 @@
     goto :goto_9
 
     :cond_f
-    sget v0, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->MODE_FLAG_ENABLED:I
-
-    invoke-virtual {v7, v0}, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->isMode(I)Z
+    invoke-virtual {v7}, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->isFingerprintUnlocked()Z
 
     move-result v0
 
     if-eqz v0, :cond_d
 
-    iget-object v0, v7, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->biometricSourceType:Landroid/hardware/biometrics/BiometricSourceType;
-
-    sget-object v1, Landroid/hardware/biometrics/BiometricSourceType;->FINGERPRINT:Landroid/hardware/biometrics/BiometricSourceType;
-
-    if-ne v0, v1, :cond_d
-
     :goto_9
     iget-object v0, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->fixedRotationMonitor:Lcom/android/systemui/keyguard/KeyguardFixedRotationMonitor;
 
@@ -1745,8 +1737,21 @@
     move/from16 v16, v9
 
     :goto_a
-    sget-object v1, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    sget-boolean v1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz v1, :cond_12
 
+    invoke-virtual {v7}, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->isFingerprintUnlocked()Z
+
+    move-result v1
+
+    if-eqz v1, :cond_12
+
+    iget-object v1, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->updateMonitor:Lcom/android/keyguard/KeyguardUpdateMonitor;
+
+    invoke-interface {v1}, Lcom/android/keyguard/KeyguardSecUpdateMonitor;->removeMaskViewForOpticalFpSensor()V
+
+    :cond_12
     invoke-virtual {v0}, Lcom/android/systemui/keyguard/KeyguardFixedRotationMonitor;->isFixedRotated()Z
 
     move-result v4
@@ -1763,7 +1768,7 @@
 
     iget-object v1, v13, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mWallpapers:[Landroid/view/RemoteAnimationTarget;
 
-    if-eqz v1, :cond_14
+    if-eqz v1, :cond_15
 
     new-instance v2, Ljava/util/ArrayList;
 
@@ -1774,7 +1779,7 @@
     const/4 v11, 0x0
 
     :goto_b
-    if-ge v11, v12, :cond_13
+    if-ge v11, v12, :cond_14
 
     aget-object v10, v1, v11
 
@@ -1782,11 +1787,11 @@
 
     iget v1, v10, Landroid/view/RemoteAnimationTarget;->mode:I
 
-    if-ne v1, v9, :cond_12
+    if-ne v1, v9, :cond_13
 
     invoke-virtual {v2, v10}, Ljava/util/ArrayList;->add(Ljava/lang/Object;)Z
 
-    :cond_12
+    :cond_13
     add-int/2addr v11, v9
 
     move-object/from16 v1, p1
@@ -1795,7 +1800,7 @@
 
     goto :goto_b
 
-    :cond_13
+    :cond_14
     new-instance v1, Ljava/util/ArrayList;
 
     const/16 v10, 0xa
@@ -1815,7 +1820,7 @@
 
     move-result v10
 
-    if-eqz v10, :cond_14
+    if-eqz v10, :cond_15
 
     invoke-interface {v2}, Ljava/util/Iterator;->next()Ljava/lang/Object;
 
@@ -1833,17 +1838,17 @@
 
     goto :goto_c
 
-    :cond_14
+    :cond_15
     iget-object v1, v13, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mApps:[Landroid/view/RemoteAnimationTarget;
 
-    if-eqz v1, :cond_15
+    if-eqz v1, :cond_16
 
     array-length v2, v1
 
     const/4 v10, 0x0
 
     :goto_d
-    if-ge v10, v2, :cond_15
+    if-ge v10, v2, :cond_16
 
     aget-object v11, v1, v10
 
@@ -1855,21 +1860,21 @@
 
     goto :goto_d
 
-    :cond_15
+    :cond_16
     invoke-virtual {v5}, Ljava/util/ArrayList;->isEmpty()Z
 
     move-result v1
 
-    if-nez v1, :cond_16
+    if-nez v1, :cond_17
 
-    if-nez v6, :cond_17
+    if-nez v6, :cond_18
 
-    :cond_16
+    :cond_17
     move-object v9, v7
 
     goto :goto_e
 
-    :cond_17
+    :cond_18
     new-instance v10, Landroid/view/SurfaceControl$Transaction;
 
     invoke-direct {v10}, Landroid/view/SurfaceControl$Transaction;-><init>()V
@@ -1902,11 +1907,11 @@
 
     move-result v0
 
-    if-nez v0, :cond_18
+    if-nez v0, :cond_19
 
     iget-object v0, v13, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mFinishedCallback:Landroid/view/IRemoteAnimationFinishedCallback;
 
-    if-eqz v0, :cond_18
+    if-eqz v0, :cond_19
 
     const/4 v1, 0x0
 
@@ -1918,7 +1923,7 @@
 
     iput-object v0, v13, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mApps:[Landroid/view/RemoteAnimationTarget;
 
-    :cond_18
+    :cond_19
     :goto_e
     sget-object v0, Ljava/lang/Boolean;->TRUE:Ljava/lang/Boolean;
 
@@ -1960,11 +1965,11 @@
 
     move-result v1
 
-    if-eqz v1, :cond_1a
+    if-eqz v1, :cond_1b
 
     iget-object v1, v13, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mFinishedCallback:Landroid/view/IRemoteAnimationFinishedCallback;
 
-    if-eqz v1, :cond_19
+    if-eqz v1, :cond_1a
 
     :try_start_0
     invoke-interface {v1}, Landroid/view/IRemoteAnimationFinishedCallback;->onAnimationFinished()V
@@ -1991,22 +1996,22 @@
 
     goto :goto_12
 
-    :cond_19
+    :cond_1a
     const/4 v3, 0x0
 
     :goto_12
     iput-object v3, v13, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mApps:[Landroid/view/RemoteAnimationTarget;
 
-    :cond_1a
-    if-eqz v0, :cond_1b
+    :cond_1b
+    if-eqz v0, :cond_1c
 
     const-string/jumbo v1, "showForegroundImmediatelyIfNeeded returns true"
 
     invoke-static {v1}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->logD(Ljava/lang/String;)V
 
-    :cond_1b
+    :cond_1c
     :goto_13
-    if-eqz v0, :cond_1e
+    if-eqz v0, :cond_1f
 
     new-instance v0, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl$handleOverrideStartKeyguardExitAnimation$1;
 
@@ -2014,7 +2019,7 @@
 
     iget-object v1, v9, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->delayedActionParams:Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController$DelayedActionParams;
 
-    if-eqz v1, :cond_1d
+    if-eqz v1, :cond_1e
 
     iget-object v2, v1, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController$DelayedActionParams;->handler:Landroid/os/Handler;
 
@@ -2024,18 +2029,18 @@
 
     move-result v4
 
-    if-eqz v4, :cond_1c
+    if-eqz v4, :cond_1d
 
     invoke-virtual {v2, v3}, Landroid/os/Handler;->removeCallbacks(Ljava/lang/Runnable;)V
 
-    :cond_1c
+    :cond_1d
     const/4 v2, 0x1
 
     iput-boolean v2, v1, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController$DelayedActionParams;->isDiscard:Z
 
     goto :goto_14
 
-    :cond_1d
+    :cond_1e
     const/4 v2, 0x1
 
     :goto_14
@@ -2053,7 +2058,7 @@
 
     goto/16 :goto_33
 
-    :cond_1e
+    :cond_1f
     iget-object v0, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->viewMediatorLazy:Ldagger/Lazy;
 
     invoke-interface {v0}, Ldagger/Lazy;->get()Ljava/lang/Object;
@@ -2066,38 +2071,38 @@
 
     move-result v0
 
-    if-eqz v0, :cond_1f
+    if-eqz v0, :cond_20
 
     goto/16 :goto_18
 
-    :cond_1f
+    :cond_20
     invoke-virtual {v8, v13}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->isDisabledUnlockAnimation(Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;)Z
 
     move-result v0
 
-    if-eqz v0, :cond_27
+    if-eqz v0, :cond_28
 
     iget-object v0, v13, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mApps:[Landroid/view/RemoteAnimationTarget;
 
-    if-eqz v0, :cond_26
+    if-eqz v0, :cond_27
 
     array-length v0, v0
 
     const/4 v1, 0x1
 
-    if-nez v0, :cond_20
+    if-nez v0, :cond_21
 
     const/16 v17, 0x1
 
     goto :goto_15
 
-    :cond_20
+    :cond_21
     const/16 v17, 0x0
 
     :goto_15
     xor-int/lit8 v0, v17, 0x1
 
-    if-eqz v0, :cond_25
+    if-eqz v0, :cond_26
 
     new-instance v1, Landroid/view/SurfaceControl$Transaction;
 
@@ -2111,7 +2116,7 @@
 
     iget-object v2, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->surfaceControllerLazy:Ldagger/Lazy;
 
-    if-nez v0, :cond_21
+    if-nez v0, :cond_22
 
     invoke-interface {v2}, Ldagger/Lazy;->get()Ljava/lang/Object;
 
@@ -2123,7 +2128,7 @@
 
     invoke-virtual {v0, v3, v1}, Lcom/android/systemui/keyguard/KeyguardSurfaceControllerImpl;->setKeyguardSurfaceAppearAmount(FLandroid/view/SurfaceControl$Transaction;)V
 
-    :cond_21
+    :cond_22
     iget-object v3, v13, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mApps:[Landroid/view/RemoteAnimationTarget;
 
     array-length v4, v3
@@ -2131,15 +2136,15 @@
     const/4 v5, 0x0
 
     :goto_16
-    if-ge v5, v4, :cond_24
+    if-ge v5, v4, :cond_25
 
     aget-object v0, v3, v5
 
-    if-eqz v0, :cond_23
+    if-eqz v0, :cond_24
 
     iget-object v0, v0, Landroid/view/RemoteAnimationTarget;->leash:Landroid/view/SurfaceControl;
 
-    if-eqz v0, :cond_23
+    if-eqz v0, :cond_24
 
     invoke-interface {v2}, Ldagger/Lazy;->get()Ljava/lang/Object;
 
@@ -2155,11 +2160,11 @@
 
     move-result v7
 
-    if-nez v7, :cond_22
+    if-nez v7, :cond_23
 
     goto :goto_17
 
-    :cond_22
+    :cond_23
     const-string v7, "KeyguardSurface"
 
     const-string/jumbo v9, "setLeashAppearAmount amount=1.0 hasTransaction=true"
@@ -2184,7 +2189,7 @@
 
     invoke-virtual {v6}, Ljava/lang/Exception;->printStackTrace()V
 
-    :cond_23
+    :cond_24
     :goto_17
     const/4 v6, 0x1
 
@@ -2192,20 +2197,20 @@
 
     goto :goto_16
 
-    :cond_24
+    :cond_25
     invoke-virtual {v1}, Landroid/view/SurfaceControl$Transaction;->apply()V
 
     invoke-virtual {v1}, Landroid/view/SurfaceControl$Transaction;->close()V
 
-    :cond_25
+    :cond_26
     const/4 v1, 0x0
 
     iput-object v1, v13, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mApps:[Landroid/view/RemoteAnimationTarget;
 
-    :cond_26
+    :cond_27
     iget-object v0, v13, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mFinishedCallback:Landroid/view/IRemoteAnimationFinishedCallback;
 
-    if-eqz v0, :cond_27
+    if-eqz v0, :cond_28
 
     :try_start_2
     const-string v1, "keepOrDisableUnlockAnimation disabled"
@@ -2221,7 +2226,7 @@
 
     iput-object v1, v13, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mFinishedCallback:Landroid/view/IRemoteAnimationFinishedCallback;
 
-    :cond_27
+    :cond_28
     :goto_18
     iget-object v0, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->pm:Landroid/os/PowerManager;
 
@@ -2239,11 +2244,11 @@
 
     move-result v0
 
-    if-nez v0, :cond_28
+    if-nez v0, :cond_29
 
     iget-boolean v0, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->hidingByDisabled:Z
 
-    if-nez v0, :cond_28
+    if-nez v0, :cond_29
 
     iget v0, v14, Landroid/os/Message;->what:I
 
@@ -2264,7 +2269,7 @@
     :try_start_3
     iget-object v0, v13, Lcom/android/systemui/keyguard/KeyguardViewMediator$StartKeyguardExitAnimParams;->mFinishedCallback:Landroid/view/IRemoteAnimationFinishedCallback;
 
-    if-eqz v0, :cond_57
+    if-eqz v0, :cond_58
 
     invoke-interface {v0}, Landroid/view/IRemoteAnimationFinishedCallback;->onAnimationFinished()V
     :try_end_3
@@ -2272,7 +2277,7 @@
 
     goto/16 :goto_33
 
-    :cond_28
+    :cond_29
     invoke-virtual/range {p0 .. p0}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->getHandler$1()Landroid/os/Handler;
 
     move-result-object v0
@@ -2292,25 +2297,25 @@
 
     const/4 v3, 0x1
 
-    if-ne v2, v3, :cond_29
+    if-ne v2, v3, :cond_2a
 
     const/4 v2, 0x1
 
     goto :goto_19
 
-    :cond_29
+    :cond_2a
     const/4 v2, 0x0
 
     :goto_19
     iget v0, v0, Landroid/os/Message;->arg2:I
 
-    if-nez v0, :cond_2a
+    if-nez v0, :cond_2b
 
     const/4 v0, 0x1
 
     goto :goto_1a
 
-    :cond_2a
+    :cond_2b
     const/4 v0, 0x0
 
     :goto_1a
@@ -2350,7 +2355,7 @@
 
     invoke-static {v5, v6}, Lcom/android/systemui/keyguard/Log;->d(Ljava/lang/String;Ljava/lang/String;)V
 
-    if-nez v0, :cond_39
+    if-nez v0, :cond_3a
 
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->foldConfig:Lcom/android/systemui/keyguard/KeyguardFoldControllerConfig;
 
@@ -2360,9 +2365,9 @@
 
     sget-boolean v3, Lcom/android/systemui/LsRune;->KEYGUARD_SUB_DISPLAY_LOCK:Z
 
-    if-eqz v3, :cond_38
+    if-eqz v3, :cond_39
 
-    if-eqz v2, :cond_37
+    if-eqz v2, :cond_38
 
     invoke-virtual {v1}, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->getViewMediator()Lcom/android/systemui/keyguard/KeyguardViewMediator;
 
@@ -2392,7 +2397,7 @@
 
     move-result v5
 
-    if-eqz v5, :cond_2b
+    if-eqz v5, :cond_2c
 
     const/4 v5, 0x1
 
@@ -2404,12 +2409,12 @@
 
     goto/16 :goto_22
 
-    :cond_2b
+    :cond_2c
     invoke-virtual {v3}, Lcom/android/systemui/keyguard/KeyguardViewMediator;->isShowingAndNotOccluded()Z
 
     move-result v5
 
-    if-eqz v5, :cond_36
+    if-eqz v5, :cond_37
 
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->foldConfig:Lcom/android/systemui/keyguard/KeyguardFoldControllerConfig;
 
@@ -2419,7 +2424,7 @@
 
     sget-boolean v3, Lcom/android/systemui/CscRune;->SECURITY_SIM_PERM_DISABLED:Z
 
-    if-eqz v3, :cond_2c
+    if-eqz v3, :cond_2d
 
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->updateMonitor:Lcom/android/keyguard/KeyguardUpdateMonitor;
 
@@ -2427,7 +2432,7 @@
 
     move-result v3
 
-    if-eqz v3, :cond_2c
+    if-eqz v3, :cond_2d
 
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->dependency:Lcom/android/systemui/keyguard/KeyguardFoldControllerDependency;
 
@@ -2443,7 +2448,7 @@
 
     goto/16 :goto_22
 
-    :cond_2c
+    :cond_2d
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->viewMediatorHelper$delegate:Lkotlin/Lazy;
 
     invoke-interface {v3}, Lkotlin/Lazy;->getValue()Ljava/lang/Object;
@@ -2467,7 +2472,7 @@
 
     move-result v6
 
-    if-eqz v6, :cond_2d
+    if-eqz v6, :cond_2e
 
     iget-boolean v3, v3, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->curIsOccluded:Z
     :try_end_4
@@ -2475,7 +2480,7 @@
 
     const/4 v6, 0x1
 
-    if-ne v6, v3, :cond_2d
+    if-ne v6, v3, :cond_2e
 
     const/4 v3, 0x1
 
@@ -2486,13 +2491,13 @@
 
     goto/16 :goto_21
 
-    :cond_2d
+    :cond_2e
     const/4 v3, 0x0
 
     :goto_1b
     monitor-exit v5
 
-    if-eqz v3, :cond_2e
+    if-eqz v3, :cond_2f
 
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->dependency:Lcom/android/systemui/keyguard/KeyguardFoldControllerDependency;
 
@@ -2508,7 +2513,7 @@
 
     goto/16 :goto_22
 
-    :cond_2e
+    :cond_2f
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->viewMediatorHelper$delegate:Lkotlin/Lazy;
 
     invoke-interface {v3}, Lkotlin/Lazy;->getValue()Ljava/lang/Object;
@@ -2539,11 +2544,11 @@
 
     iget-object v3, v3, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->viewMediatorProvider:Lcom/android/systemui/keyguard/ViewMediatorProvider;
 
-    if-eqz v3, :cond_2f
+    if-eqz v3, :cond_30
 
     goto :goto_1c
 
-    :cond_2f
+    :cond_30
     const/4 v3, 0x0
 
     :goto_1c
@@ -2563,7 +2568,7 @@
 
     xor-int/2addr v3, v5
 
-    if-eqz v3, :cond_30
+    if-eqz v3, :cond_31
 
     iget-object v5, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->dependency:Lcom/android/systemui/keyguard/KeyguardFoldControllerDependency;
 
@@ -2575,7 +2580,7 @@
 
     invoke-static {v6}, Lcom/android/systemui/keyguard/KeyguardUnlockInfo;->setAuthDetail(Lcom/android/keyguard/KeyguardSecurityModel$SecurityMode;)V
 
-    :cond_30
+    :cond_31
     iget-object v5, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->updateMonitor:Lcom/android/keyguard/KeyguardUpdateMonitor;
 
     iget-object v6, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->selectedUserInteractor:Lcom/android/systemui/user/domain/interactor/SelectedUserInteractor;
@@ -2590,13 +2595,13 @@
 
     move-result v5
 
-    if-nez v3, :cond_32
+    if-nez v3, :cond_33
 
-    if-eqz v5, :cond_31
+    if-eqz v5, :cond_32
 
     goto :goto_1d
 
-    :cond_31
+    :cond_32
     const/4 v3, 0x1
 
     invoke-virtual {v1, v3}, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->setFoldOpenState(I)V
@@ -2613,7 +2618,7 @@
 
     goto/16 :goto_22
 
-    :cond_32
+    :cond_33
     :goto_1d
     invoke-virtual {v1}, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->getViewMediator()Lcom/android/systemui/keyguard/KeyguardViewMediator;
 
@@ -2627,22 +2632,22 @@
 
     move-result v3
 
-    if-eqz v3, :cond_34
+    if-eqz v3, :cond_35
 
     iget v3, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->wakeReason:I
 
     const/16 v5, 0x9
 
-    if-ne v3, v5, :cond_33
+    if-ne v3, v5, :cond_34
 
     goto :goto_1e
 
-    :cond_33
+    :cond_34
     move v12, v4
 
     goto :goto_1f
 
-    :cond_34
+    :cond_35
     :goto_1e
     const/4 v12, 0x3
 
@@ -2665,13 +2670,13 @@
 
     iget-object v3, v3, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->viewMediatorProvider:Lcom/android/systemui/keyguard/ViewMediatorProvider;
 
-    if-eqz v3, :cond_35
+    if-eqz v3, :cond_36
 
     move-object v10, v3
 
     goto :goto_20
 
-    :cond_35
+    :cond_36
     const/4 v10, 0x0
 
     :goto_20
@@ -2686,7 +2691,7 @@
 
     throw v0
 
-    :cond_36
+    :cond_37
     invoke-virtual {v3}, Lcom/android/systemui/keyguard/KeyguardViewMediator;->maybeHandlePendingLock()V
 
     iget-object v4, v3, Lcom/android/systemui/keyguard/KeyguardViewMediator;->mHelper:Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;
@@ -2703,7 +2708,7 @@
 
     move-result v4
 
-    if-eqz v4, :cond_39
+    if-eqz v4, :cond_3a
 
     const/4 v4, 0x1
 
@@ -2715,7 +2720,7 @@
 
     goto :goto_22
 
-    :cond_37
+    :cond_38
     invoke-virtual {v1}, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->getViewMediator()Lcom/android/systemui/keyguard/KeyguardViewMediator;
 
     move-result-object v3
@@ -2724,7 +2729,7 @@
 
     move-result v4
 
-    if-eqz v4, :cond_39
+    if-eqz v4, :cond_3a
 
     invoke-virtual {v3}, Lcom/android/systemui/keyguard/KeyguardViewMediator;->getViewMediatorCallback()Lcom/android/keyguard/ViewMediatorCallback;
 
@@ -2734,7 +2739,7 @@
 
     goto :goto_22
 
-    :cond_38
+    :cond_39
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->foldConfig:Lcom/android/systemui/keyguard/KeyguardFoldControllerConfig;
 
     check-cast v3, Lcom/android/systemui/keyguard/KeyguardFoldControllerConfigImpl;
@@ -2743,7 +2748,7 @@
 
     sget-boolean v3, Lcom/android/systemui/LsRune;->SUBSCREEN_WATCHFACE:Z
 
-    if-eqz v3, :cond_39
+    if-eqz v3, :cond_3a
 
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->viewMediatorHelper$delegate:Lkotlin/Lazy;
 
@@ -2757,7 +2762,7 @@
 
     invoke-virtual {v3}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->adjustStatusBarLocked$2()V
 
-    :cond_39
+    :cond_3a
     :goto_22
     iget-object v3, v1, Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;->normalRankedStateListeners:Ljava/util/List;
 
@@ -2778,19 +2783,19 @@
 
     iget-object v0, v0, Landroid/os/Message;->obj:Ljava/lang/Object;
 
-    if-eqz v0, :cond_3a
+    if-eqz v0, :cond_3b
 
     check-cast v0, Lcom/android/internal/policy/IKeyguardDrawnCallback;
 
     goto :goto_23
 
-    :cond_3a
+    :cond_3b
     const/4 v0, 0x0
 
     :goto_23
     const-string v1, "handleNotifyScreenTurningOn fastWakeUnlockMode="
 
-    if-nez v0, :cond_3f
+    if-nez v0, :cond_40
 
     iget-object v2, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->fastUnlockController:Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;
 
@@ -2798,7 +2803,7 @@
 
     move-result v2
 
-    if-eqz v2, :cond_3d
+    if-eqz v2, :cond_3e
 
     iget-object v2, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->fastUnlockController:Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;
 
@@ -2812,23 +2817,23 @@
 
     move-result v2
 
-    if-eqz v2, :cond_3b
+    if-eqz v2, :cond_3c
 
     sget v2, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->MODE_FLAG_FRAME_COMMIT:I
 
     and-int/2addr v2, v3
 
-    if-nez v2, :cond_3b
+    if-nez v2, :cond_3c
 
     sget v2, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->MODE_FLAG_FRAME_REQUEST:I
 
     and-int/2addr v3, v2
 
-    if-ne v3, v2, :cond_3b
+    if-ne v3, v2, :cond_3c
 
     goto :goto_25
 
-    :cond_3b
+    :cond_3c
     iget-object v2, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->fastUnlockController:Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;
 
     invoke-virtual {v2}, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->getMode()I
@@ -2839,34 +2844,34 @@
 
     move-result v2
 
-    if-eqz v2, :cond_3c
+    if-eqz v2, :cond_3d
 
     sget v2, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->MODE_FLAG_FRAME_COMMIT:I
 
     and-int/2addr v3, v2
 
-    if-ne v3, v2, :cond_3c
+    if-ne v3, v2, :cond_3d
 
     const/4 v2, 0x1
 
     goto :goto_24
 
-    :cond_3c
+    :cond_3d
     move v2, v4
 
     :goto_24
-    if-nez v2, :cond_3e
+    if-nez v2, :cond_3f
 
-    :cond_3d
+    :cond_3e
     iget-object v2, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->fastUnlockController:Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;
 
     invoke-virtual {v2}, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->isFastWakeAndUnlockMode()Z
 
     move-result v2
 
-    if-nez v2, :cond_3f
+    if-nez v2, :cond_40
 
-    :cond_3e
+    :cond_3f
     :goto_25
     const-string v0, "handleNotifyScreenTurningOn"
 
@@ -2876,7 +2881,7 @@
 
     goto/16 :goto_33
 
-    :cond_3f
+    :cond_40
     iget-object v2, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->lock$delegate:Lkotlin/Lazy;
 
     invoke-interface {v2}, Lkotlin/Lazy;->getValue()Ljava/lang/Object;
@@ -2908,13 +2913,13 @@
 
     iget v5, v5, Lcom/android/systemui/statusbar/phone/BiometricUnlockController;->mMode:I
 
-    if-eqz v5, :cond_40
+    if-eqz v5, :cond_41
 
     const/4 v5, 0x1
 
     goto :goto_26
 
-    :cond_40
+    :cond_41
     move v5, v4
 
     :goto_26
@@ -2924,7 +2929,7 @@
 
     cmp-long v6, v6, v9
 
-    if-eqz v6, :cond_41
+    if-eqz v6, :cond_42
 
     invoke-static {}, Landroid/os/SystemClock;->elapsedRealtime()J
 
@@ -2941,7 +2946,7 @@
 
     goto/16 :goto_2a
 
-    :cond_41
+    :cond_42
     :goto_27
     iget-object v6, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->fastUnlockController:Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;
 
@@ -2951,11 +2956,11 @@
 
     iget-object v7, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->viewMediatorProvider:Lcom/android/systemui/keyguard/ViewMediatorProvider;
 
-    if-eqz v7, :cond_42
+    if-eqz v7, :cond_43
 
     goto :goto_28
 
-    :cond_42
+    :cond_43
     const/4 v7, 0x0
 
     :goto_28
@@ -2975,11 +2980,11 @@
 
     move-result v11
 
-    if-eqz v0, :cond_43
+    if-eqz v0, :cond_44
 
     const/4 v4, 0x1
 
-    :cond_43
+    :cond_44
     new-instance v12, Ljava/lang/StringBuilder;
 
     invoke-direct {v12, v1}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
@@ -3030,38 +3035,38 @@
     :try_end_5
     .catchall {:try_start_5 .. :try_end_5} :catchall_1
 
-    if-nez v0, :cond_44
+    if-nez v0, :cond_45
 
     monitor-exit v2
 
     goto/16 :goto_33
 
-    :cond_44
+    :cond_45
     :try_start_6
     iget-object v1, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->fastUnlockController:Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;
 
     iget-boolean v1, v1, Lcom/android/systemui/keyguard/KeyguardFastBioUnlockController;->needsBlankScreen:Z
 
-    if-nez v1, :cond_45
+    if-nez v1, :cond_46
 
-    if-nez v6, :cond_46
+    if-nez v6, :cond_47
 
-    :cond_45
-    if-nez v5, :cond_47
+    :cond_46
+    if-nez v5, :cond_48
 
-    if-nez v3, :cond_46
+    if-nez v3, :cond_47
 
-    if-eqz v7, :cond_47
+    if-eqz v7, :cond_48
 
-    :cond_46
+    :cond_47
     iput-object v0, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->drawnCallback:Lcom/android/internal/policy/IKeyguardDrawnCallback;
 
     goto :goto_29
 
-    :cond_47
+    :cond_48
     sget-boolean v1, Lcom/android/systemui/LsRune;->KEYGUARD_DELAY_NOTIFY_DRAWN_PREMIUM_WATCH:Z
 
-    if-eqz v1, :cond_49
+    if-eqz v1, :cond_4a
 
     iget-object v1, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->foldControllerImpl:Lcom/android/systemui/keyguard/KeyguardFoldControllerImpl;
 
@@ -3069,7 +3074,7 @@
 
     move-result v1
 
-    if-nez v1, :cond_49
+    if-nez v1, :cond_4a
 
     iget-object v1, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->settingsHelper:Lcom/android/systemui/util/SettingsHelper;
 
@@ -3077,13 +3082,13 @@
 
     move-result v1
 
-    if-eqz v1, :cond_49
+    if-eqz v1, :cond_4a
 
     invoke-virtual/range {p0 .. p0}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->hasOccludedMsg$1()Z
 
     move-result v1
 
-    if-nez v1, :cond_48
+    if-nez v1, :cond_49
 
     iget-object v1, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->viewMediatorLazy:Ldagger/Lazy;
 
@@ -3097,16 +3102,16 @@
 
     move-result v1
 
-    if-nez v1, :cond_49
+    if-nez v1, :cond_4a
 
-    :cond_48
+    :cond_49
     iget-object v1, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->keyguardVisibilityMonitor:Lcom/android/systemui/keyguard/KeyguardVisibilityMonitor;
 
     invoke-virtual {v1}, Lcom/android/systemui/keyguard/KeyguardVisibilityMonitor;->isVisible()Z
 
     move-result v1
 
-    if-eqz v1, :cond_49
+    if-eqz v1, :cond_4a
 
     iput-object v0, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->drawnCallback:Lcom/android/internal/policy/IKeyguardDrawnCallback;
 
@@ -3132,14 +3137,14 @@
 
     goto/16 :goto_33
 
-    :cond_49
+    :cond_4a
     const-wide/16 v3, 0xc8
 
     cmp-long v1, v9, v3
 
-    if-gez v1, :cond_4a
+    if-gez v1, :cond_4b
 
-    if-nez v5, :cond_4a
+    if-nez v5, :cond_4b
 
     :try_start_7
     iput-object v0, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->drawnCallback:Lcom/android/internal/policy/IKeyguardDrawnCallback;
@@ -3162,7 +3167,7 @@
 
     goto/16 :goto_33
 
-    :cond_4a
+    :cond_4b
     :try_start_8
     invoke-virtual {v8, v0}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->notifyDrawn(Lcom/android/internal/policy/IKeyguardDrawnCallback;)V
 
@@ -3189,7 +3194,7 @@
 
     goto/16 :goto_33
 
-    :cond_4b
+    :cond_4c
     const-string v0, "adjustStatusBarLocked - ADJUST_STATUS_BAR : flags=0x"
 
     :try_start_9
@@ -3197,7 +3202,7 @@
 
     move-result-object v1
 
-    if-eqz v1, :cond_57
+    if-eqz v1, :cond_58
 
     iget v2, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->disableFlags:I
 
@@ -3246,7 +3251,7 @@
 
     goto/16 :goto_33
 
-    :cond_4c
+    :cond_4d
     const/4 v4, 0x0
 
     const-string v0, "handleBootCompleted"
@@ -3255,7 +3260,7 @@
 
     sget-boolean v0, Lcom/android/systemui/LsRune;->SUBSCREEN_UI:Z
 
-    if-eqz v0, :cond_57
+    if-eqz v0, :cond_58
 
     iget-object v0, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->subScreenManager:Lcom/android/systemui/subscreen/SubScreenManager;
 
@@ -3269,7 +3274,7 @@
 
     iget-object v2, v0, Lcom/android/systemui/subscreen/SubScreenManager;->mSubDisplay:Landroid/view/Display;
 
-    if-nez v2, :cond_57
+    if-nez v2, :cond_58
 
     const-string v2, "init() "
 
@@ -3283,7 +3288,7 @@
 
     move-result-object v2
 
-    if-eqz v2, :cond_4f
+    if-eqz v2, :cond_50
 
     new-instance v3, Ljava/lang/StringBuilder;
 
@@ -3300,11 +3305,11 @@
     move v11, v4
 
     :goto_2b
-    if-ge v11, v3, :cond_4f
+    if-ge v11, v3, :cond_50
 
     aget-object v4, v2, v11
 
-    if-nez v4, :cond_4d
+    if-nez v4, :cond_4e
 
     const-string v4, "Do not show SubScreen UI on null display"
 
@@ -3315,14 +3320,14 @@
 
     goto :goto_2d
 
-    :cond_4d
+    :cond_4e
     invoke-virtual {v4}, Landroid/view/Display;->getDisplayId()I
 
     move-result v5
 
     const/4 v6, 0x1
 
-    if-ne v5, v6, :cond_4e
+    if-ne v5, v6, :cond_4f
 
     new-instance v2, Ljava/lang/StringBuilder;
 
@@ -3342,7 +3347,7 @@
 
     goto :goto_2e
 
-    :cond_4e
+    :cond_4f
     new-instance v5, Ljava/lang/StringBuilder;
 
     const-string v6, "Do not show SubScreen UI on this display "
@@ -3364,7 +3369,7 @@
 
     goto :goto_2b
 
-    :cond_4f
+    :cond_50
     const/4 v10, 0x0
 
     :goto_2e
@@ -3378,7 +3383,7 @@
 
     sget-boolean v1, Lcom/android/systemui/LsRune;->SUBSCREEN_LARGE_FRONT_SUB_DISPLAY:Z
 
-    if-eqz v1, :cond_57
+    if-eqz v1, :cond_58
 
     new-instance v1, Lcom/android/systemui/subscreen/SubScreenManager$6;
 
@@ -3390,7 +3395,7 @@
 
     goto/16 :goto_33
 
-    :cond_50
+    :cond_51
     const-string v0, "handleLaunchPersoLock"
 
     invoke-static {v0}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->logD(Ljava/lang/String;)V
@@ -3414,7 +3419,7 @@
 
     move-result v0
 
-    if-nez v0, :cond_51
+    if-nez v0, :cond_52
 
     const-string v0, "doKeyguardLocked"
 
@@ -3445,7 +3450,7 @@
 
     goto :goto_31
 
-    :cond_51
+    :cond_52
     iget-object v0, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->KEYGUARD_DONE$delegate:Lkotlin/Lazy;
 
     invoke-interface {v0}, Lkotlin/Lazy;->getValue()Ljava/lang/Object;
@@ -3486,17 +3491,17 @@
 
     move-result v0
 
-    if-eqz v0, :cond_53
+    if-eqz v0, :cond_54
 
     iget-object v0, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->viewMediatorProvider:Lcom/android/systemui/keyguard/ViewMediatorProvider;
 
-    if-eqz v0, :cond_52
+    if-eqz v0, :cond_53
 
     move-object v10, v0
 
     goto :goto_2f
 
-    :cond_52
+    :cond_53
     const/4 v10, 0x0
 
     :goto_2f
@@ -3506,7 +3511,7 @@
 
     invoke-interface {v0, v2}, Lkotlin/jvm/functions/Function1;->invoke(Ljava/lang/Object;)Ljava/lang/Object;
 
-    :cond_53
+    :cond_54
     invoke-virtual/range {p0 .. p0}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->resetStateLocked$2()V
 
     :goto_30
@@ -3523,7 +3528,7 @@
 
     throw v0
 
-    :cond_54
+    :cond_55
     iget-object v0, v0, Landroid/os/Message;->obj:Ljava/lang/Object;
 
     const-string v1, "handleRemoteLockRequested"
@@ -3532,13 +3537,13 @@
 
     instance-of v1, v0, Lcom/android/internal/widget/RemoteLockInfo;
 
-    if-eqz v1, :cond_55
+    if-eqz v1, :cond_56
 
     check-cast v0, Lcom/android/internal/widget/RemoteLockInfo;
 
     iget-boolean v0, v0, Lcom/android/internal/widget/RemoteLockInfo;->lockState:Z
 
-    if-nez v0, :cond_55
+    if-nez v0, :cond_56
 
     iget-object v0, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->updateMonitor:Lcom/android/keyguard/KeyguardUpdateMonitor;
 
@@ -3548,7 +3553,7 @@
 
     const/4 v1, -0x1
 
-    if-ne v0, v1, :cond_57
+    if-ne v0, v1, :cond_58
 
     iget-object v0, v8, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->viewMediatorLazy:Ldagger/Lazy;
 
@@ -3562,18 +3567,18 @@
 
     move-result v0
 
-    if-eqz v0, :cond_57
+    if-eqz v0, :cond_58
 
     invoke-virtual/range {p0 .. p0}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->resetStateLocked$2()V
 
     goto :goto_33
 
-    :cond_55
+    :cond_56
     invoke-virtual/range {p0 .. p0}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->isShowing$1()Z
 
     move-result v0
 
-    if-nez v0, :cond_56
+    if-nez v0, :cond_57
 
     const/4 v1, 0x0
 
@@ -3581,7 +3586,7 @@
 
     goto :goto_32
 
-    :cond_56
+    :cond_57
     invoke-virtual/range {p0 .. p0}, Lcom/android/systemui/keyguard/KeyguardViewMediatorHelperImpl;->resetStateLocked$2()V
 
     :goto_32
@@ -3594,10 +3599,12 @@
     invoke-virtual {v0, v1, v2}, Landroid/os/PowerManager;->wakeUp(J)V
 
     :catch_4
-    :cond_57
+    :cond_58
     :goto_33
     return-void
 
+    nop
+
     :pswitch_data_0
     .packed-switch 0x3e9
         :pswitch_5
diff --git a/smali_classes2/com/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl.smali b/smali_classes2/com/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl.smali
index aa095b33..6a298411 100644
--- a/smali_classes2/com/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl.smali
+++ b/smali_classes2/com/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl.smali
@@ -597,12 +597,21 @@
 
     const/high16 v1, 0x40000
 
+    or-int/2addr v1, v0
+
+    iput v1, p1, Landroid/view/WindowManager$LayoutParams;->samsungFlags:I
+
+    sget-boolean v1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz v1, :cond_1
+
+    const/high16 v1, 0x60000
+
     or-int/2addr v0, v1
 
     iput v0, p1, Landroid/view/WindowManager$LayoutParams;->samsungFlags:I
 
-    sget-object v0, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
-
+    :cond_1
     invoke-virtual {p0}, Lcom/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl;->getCurrentState()Lcom/android/systemui/shade/NotificationShadeWindowState;
 
     move-result-object v0
@@ -611,7 +620,7 @@
 
     const/4 v2, 0x1
 
-    if-ne v1, v2, :cond_1
+    if-ne v1, v2, :cond_2
 
     iget-wide v0, v0, Lcom/android/systemui/shade/NotificationShadeWindowState;->keyguardUserActivityTimeout:J
 
@@ -619,16 +628,16 @@
 
     cmp-long v5, v0, v3
 
-    if-gez v5, :cond_2
+    if-gez v5, :cond_3
 
     move-wide v0, v3
 
     goto :goto_1
 
-    :cond_1
+    :cond_2
     const-wide/16 v0, -0x1
 
-    :cond_2
+    :cond_3
     :goto_1
     iput-wide v0, p1, Landroid/view/WindowManager$LayoutParams;->userActivityTimeout:J
 
@@ -642,13 +651,13 @@
 
     sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_PUNCH_HOLE_FACE_VI:Z
 
-    if-eqz v0, :cond_3
+    if-eqz v0, :cond_4
 
     iput v2, p1, Landroid/view/WindowManager$LayoutParams;->layoutInDisplayCutoutMode:I
 
     goto :goto_2
 
-    :cond_3
+    :cond_4
     const/4 v0, 0x3
 
     iput v0, p1, Landroid/view/WindowManager$LayoutParams;->layoutInDisplayCutoutMode:I
diff --git a/smali_classes3/com/android/systemui/statusbar/phone/CentralSurfacesImpl.smali b/smali_classes3/com/android/systemui/statusbar/phone/CentralSurfacesImpl.smali
index 2b8e9fa0..ea42409d 100644
--- a/smali_classes3/com/android/systemui/statusbar/phone/CentralSurfacesImpl.smali
+++ b/smali_classes3/com/android/systemui/statusbar/phone/CentralSurfacesImpl.smali
@@ -6038,13 +6038,26 @@
 
     invoke-static {}, Lcom/android/systemui/Flags;->sceneContainer()V
 
-    sget-object v0, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
 
+    if-eqz v0, :cond_2e
+
+    iget-object v0, v1, Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl;->mLp:Landroid/view/WindowManager$LayoutParams;
+
+    iget v2, v0, Landroid/view/WindowManager$LayoutParams;->samsungFlags:I
+
+    const/high16 v3, 0x20000
+
+    or-int/2addr v2, v3
+
+    iput v2, v0, Landroid/view/WindowManager$LayoutParams;->samsungFlags:I
+
+    :cond_2e
     iget-object v0, v1, Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl;->mIndicatorCutoutUtil:Lcom/android/systemui/statusbar/phone/IndicatorCutoutUtil;
 
     iget-boolean v0, v0, Lcom/android/systemui/statusbar/phone/IndicatorCutoutUtil;->isUDCModel:Z
 
-    if-eqz v0, :cond_2e
+    if-eqz v0, :cond_2f
 
     iget-object v0, v1, Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl;->mLp:Landroid/view/WindowManager$LayoutParams;
 
@@ -6052,7 +6065,7 @@
 
     invoke-virtual {v0, v2}, Landroid/view/WindowManager$LayoutParams;->semAddExtensionFlags(I)V
 
-    :cond_2e
+    :cond_2f
     iget-object v0, v1, Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl;->mWindowManager:Landroid/view/WindowManager;
 
     iget-object v2, v1, Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl;->mWindowRootView:Lcom/android/systemui/scene/ui/view/WindowRootView;
@@ -6067,7 +6080,7 @@
 
     move-result-object v0
 
-    if-eqz v0, :cond_2f
+    if-eqz v0, :cond_30
 
     iget-object v0, v1, Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl;->mWindowRootView:Lcom/android/systemui/scene/ui/view/WindowRootView;
 
@@ -6079,7 +6092,7 @@
 
     invoke-interface {v0, v2}, Landroid/view/WindowInsetsController;->setSystemBarsBehavior(I)V
 
-    :cond_2f
+    :cond_30
     iget-object v0, v1, Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl;->mLpChanged:Landroid/view/WindowManager$LayoutParams;
 
     iget-object v2, v1, Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl;->mLp:Landroid/view/WindowManager$LayoutParams;
@@ -6096,11 +6109,11 @@
 
     const/4 v2, 0x1
 
-    if-eqz v0, :cond_30
+    if-eqz v0, :cond_31
 
     invoke-virtual {v1, v2}, Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl;->setKeyguardShowing(Z)V
 
-    :cond_30
+    :cond_31
     new-instance v0, Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl$$ExternalSyntheticLambda11;
 
     invoke-direct {v0, v1, v2}, Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl$$ExternalSyntheticLambda11;-><init>(Lcom/android/systemui/shade/NotificationShadeWindowControllerImpl;I)V
@@ -6109,14 +6122,14 @@
 
     iget-object v2, v1, Lcom/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl;->pluginLockMediator:Lcom/android/systemui/pluginlock/PluginLockMediator;
 
-    if-eqz v2, :cond_31
+    if-eqz v2, :cond_32
 
     iget-object v3, v1, Lcom/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl;->notificationShadeView:Landroid/view/ViewGroup;
 
     invoke-interface {v2, v3}, Lcom/android/systemui/pluginlock/PluginLockMediator;->onRootViewAttached(Landroid/view/ViewGroup;)V
 
-    :cond_31
-    if-eqz v2, :cond_32
+    :cond_32
+    if-eqz v2, :cond_33
 
     new-instance v3, Lcom/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl$attach$1;
 
@@ -6124,7 +6137,7 @@
 
     invoke-interface {v2, v3}, Lcom/android/systemui/pluginlock/PluginLockMediator;->setNoSensorConsumer(Ljava/util/function/Consumer;)V
 
-    :cond_32
+    :cond_33
     new-instance v2, Lcom/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl$attach$2;
 
     invoke-direct {v2, v1}, Lcom/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl$attach$2;-><init>(Lcom/android/systemui/shade/SecNotificationShadeWindowControllerHelperImpl;)V
@@ -6210,7 +6223,7 @@
     :goto_c
     const/4 v3, 0x3
 
-    if-gt v2, v3, :cond_33
+    if-gt v2, v3, :cond_34
 
     iget-object v3, v1, Landroid/view/WindowManager$LayoutParams;->paramsForRotation:[Landroid/view/WindowManager$LayoutParams;
 
@@ -6226,7 +6239,7 @@
 
     goto :goto_c
 
-    :cond_33
+    :cond_34
     iput-object v1, v0, Lcom/android/systemui/statusbar/window/StatusBarWindowController;->mLp:Landroid/view/WindowManager$LayoutParams;
 
     invoke-static {}, Landroid/os/Trace;->endSection()V
@@ -6351,7 +6364,7 @@
 
     sget-boolean v2, Lcom/android/systemui/NotiRune;->NOTI_SUBSCREEN_ALL:Z
 
-    if-eqz v2, :cond_34
+    if-eqz v2, :cond_35
 
     const-class v2, Lcom/android/systemui/statusbar/notification/SubscreenNotificationController;
 
@@ -6373,11 +6386,11 @@
 
     iget-object v2, v2, Lcom/android/systemui/statusbar/notification/SubscreenNotificationController;->mDeviceModel:Lcom/android/systemui/statusbar/notification/SubscreenDeviceModelParent;
 
-    if-eqz v2, :cond_34
+    if-eqz v2, :cond_35
 
     iput-object v1, v2, Lcom/android/systemui/statusbar/notification/SubscreenDeviceModelParent;->mNotificationActivityStarter:Lcom/android/systemui/statusbar/notification/NotificationActivityStarter;
 
-    :cond_34
+    :cond_35
     move-object/from16 v8, v20
 
     iget v1, v8, Lcom/android/internal/statusbar/RegisterStatusBarResult;->mTransientBarTypes:I
@@ -6388,7 +6401,7 @@
 
     and-int/2addr v1, v2
 
-    if-eqz v1, :cond_36
+    if-eqz v1, :cond_37
 
     move-object/from16 v4, v29
 
@@ -6406,7 +6419,7 @@
 
     check-cast v2, Lcom/android/systemui/statusbar/phone/CentralSurfaces;
 
-    if-eqz v2, :cond_35
+    if-eqz v2, :cond_36
 
     check-cast v2, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;
 
@@ -6414,7 +6427,7 @@
 
     iput-boolean v3, v2, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mNoAnimationOnNextBarModeChange:Z
 
-    :cond_35
+    :cond_36
     iget-object v1, v1, Lcom/android/systemui/statusbar/data/repository/StatusBarModePerDisplayRepositoryImpl;->_isTransientShown:Lkotlinx/coroutines/flow/StateFlowImpl;
 
     sget-object v2, Ljava/lang/Boolean;->TRUE:Ljava/lang/Boolean;
@@ -6423,7 +6436,7 @@
 
     invoke-virtual {v1, v3, v2}, Lkotlinx/coroutines/flow/StateFlowImpl;->updateState(Ljava/lang/Object;Ljava/lang/Object;)Z
 
-    :cond_36
+    :cond_37
     iget-object v1, v7, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mCommandQueueCallbacks:Lcom/android/systemui/statusbar/phone/CentralSurfacesCommandQueueCallbacks;
 
     invoke-virtual {v1}, Ljava/lang/Object;->getClass()Ljava/lang/Class;
@@ -6441,7 +6454,7 @@
     const/4 v2, 0x0
 
     :goto_d
-    if-ge v2, v1, :cond_37
+    if-ge v2, v1, :cond_38
 
     iget-object v3, v8, Lcom/android/internal/statusbar/RegisterStatusBarResult;->mIcons:Landroid/util/ArrayMap;
 
@@ -6469,7 +6482,7 @@
 
     goto :goto_d
 
-    :cond_37
+    :cond_38
     const-string v1, "com.android.systemui.statusbar.banner_action_cancel"
 
     const-string v2, "com.android.systemui.statusbar.banner_action_setup"
@@ -6492,7 +6505,7 @@
 
     iget-boolean v1, v7, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mWallpaperSupported:Z
 
-    if-eqz v1, :cond_38
+    if-eqz v1, :cond_39
 
     const-string/jumbo v1, "wallpaper"
 
@@ -6514,7 +6527,7 @@
     .catch Landroid/os/RemoteException; {:try_start_1 .. :try_end_1} :catch_1
 
     :catch_1
-    :cond_38
+    :cond_39
     iget-object v1, v7, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mIconPolicy:Lcom/android/systemui/statusbar/phone/PhoneStatusBarPolicy;
 
     invoke-virtual {v1}, Lcom/android/systemui/statusbar/phone/PhoneStatusBarPolicy;->init()V
@@ -6622,13 +6635,13 @@
 
     move-result v3
 
-    if-nez v3, :cond_39
+    if-nez v3, :cond_3a
 
     iget-object v3, v2, Lcom/android/systemui/statusbar/phone/BiometricUnlockController;->mUpdateMonitor:Lcom/android/keyguard/KeyguardUpdateMonitor;
 
     invoke-interface {v3, v2}, Lcom/android/keyguard/KeyguardSecUpdateMonitor;->registerPreCallback(Lcom/android/keyguard/KeyguardUpdateMonitorCallback;)V
 
-    :cond_39
+    :cond_3a
     invoke-virtual {v0, v1}, Lcom/android/systemui/statusbar/NotificationRemoteInputManager;->addControllerCallback(Lcom/android/systemui/statusbar/RemoteInputController$Callback;)V
 
     iget-object v0, v7, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mBiometricUnlockController:Lcom/android/systemui/statusbar/phone/BiometricUnlockController;
@@ -6639,14 +6652,14 @@
 
     sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_DEFAULT_LANDSCAPE:Z
 
-    if-eqz v0, :cond_3a
+    if-eqz v0, :cond_3b
 
     invoke-static {}, Lcom/android/systemui/util/DeviceState;->setLandscapeDefaultRotation()V
 
-    :cond_3a
+    :cond_3b
     sget-boolean v0, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY:Z
 
-    if-eqz v0, :cond_3b
+    if-eqz v0, :cond_3c
 
     iget-object v0, v7, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mContext:Landroid/content/Context;
 
@@ -6660,7 +6673,7 @@
 
     invoke-static {v0}, Lcom/android/systemui/util/DeviceState;->setInDisplayFingerprintSensorPosition(Landroid/util/DisplayMetrics;)V
 
-    :cond_3b
+    :cond_3c
     invoke-static {}, Landroid/os/Trace;->endSection()V
 
     iget-object v0, v7, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mUpdateCallback:Lcom/android/keyguard/KeyguardUpdateMonitorCallback;
@@ -6725,7 +6738,7 @@
 
     iget-boolean v1, v0, Lcom/android/systemui/InitController;->mTasksExecuted:Z
 
-    if-nez v1, :cond_3d
+    if-nez v1, :cond_3e
 
     iget-object v0, v0, Lcom/android/systemui/InitController;->mTasks:Ljava/util/ArrayList;
 
@@ -6809,7 +6822,7 @@
 
     sget-boolean v0, Lcom/android/systemui/LsRune;->AOD_LIGHT_REVEAL:Z
 
-    if-eqz v0, :cond_3c
+    if-eqz v0, :cond_3d
 
     iget-object v0, v7, Lcom/android/systemui/statusbar/phone/CentralSurfacesImpl;->mSecLightRevealScrimHelper:Lcom/android/systemui/statusbar/SecLightRevealScrimHelper;
 
@@ -6881,10 +6894,10 @@
 
     invoke-static/range {v5 .. v12}, Lcom/android/systemui/broadcast/BroadcastDispatcher;->registerReceiver$default(Lcom/android/systemui/broadcast/BroadcastDispatcher;Landroid/content/BroadcastReceiver;Landroid/content/IntentFilter;Ljava/util/concurrent/Executor;Landroid/os/UserHandle;ILjava/lang/String;I)V
 
-    :cond_3c
+    :cond_3d
     return-void
 
-    :cond_3d
+    :cond_3e
     new-instance v0, Ljava/lang/IllegalStateException;
 
     const-string v1, "post init tasks have already been executed!"
diff --git a/smali_classes3/com/android/systemui/util/DeviceState.smali b/smali_classes3/com/android/systemui/util/DeviceState.smali
index 38eca92a..64882a9e 100644
--- a/smali_classes3/com/android/systemui/util/DeviceState.smali
+++ b/smali_classes3/com/android/systemui/util/DeviceState.smali
@@ -1114,21 +1114,47 @@
     :catchall_0
     move-exception v1
 
-    goto :goto_1
+    goto :goto_3
 
     :cond_0
     :goto_0
-    sget-object v1, Lcom/android/systemui/LsRune;->VALUE_SUB_DISPLAY_POLICY:Ljava/lang/String;
+    sget-boolean v1, Lcom/android/systemui/LsRune;->SECURITY_FINGERPRINT_IN_DISPLAY_OPTICAL:Z
+
+    if-eqz v1, :cond_2
+
+    sget-object v1, Lcom/android/systemui/util/DeviceState;->sDisplaySize:Landroid/graphics/Point;
+
+    iget v2, v1, Landroid/graphics/Point;->x:I
+
+    iget v1, v1, Landroid/graphics/Point;->y:I
+
+    invoke-static {v2, v1}, Ljava/lang/Math;->min(II)I
+
+    move-result v1
     :try_end_0
     .catchall {:try_start_0 .. :try_end_0} :catchall_0
 
-    monitor-exit v0
+    const/16 v2, 0x2d0
 
-    const/4 v0, 0x1
+    if-le v1, v2, :cond_1
 
-    return v0
+    goto :goto_1
 
+    :cond_1
+    const/4 v1, 0x0
+
+    goto :goto_2
+
+    :cond_2
     :goto_1
+    const/4 v1, 0x1
+
+    :goto_2
+    monitor-exit v0
+
+    return v1
+
+    :goto_3
     monitor-exit v0
 
     throw v1
-- 
2.46.0

